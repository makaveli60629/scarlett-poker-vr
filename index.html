<!DOCTYPE html>
<html>
  <head>
    <title>Poker VR - Update 1.3 Final (Stability & Leap)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://raw.githack.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
  </head>
  <body>
    <a-scene physics="driver: local; gravity: -9.8; debug: false; iterations: 15">
      
      <a-assets>
        <img id="feltTexture" src="table_felt.jpg" crossorigin="anonymous">
        <img id="woodTexture" src="wood_grain.jpg" crossorigin="anonymous">
        <img id="leatherTexture" src="leather_armrest.jpg" crossorigin="anonymous">
        <img id="brickWall" src="https://i.imgur.com/8X8hIqB.jpg" crossorigin="anonymous">
        <img id="casinoArt" src="https://i.imgur.com/v8p0O8N.jpg" crossorigin="anonymous">
        <audio id="lobbyMusic" src="lobby_ambience.mp3" preload="auto"></audio>
      </a-assets>

      <a-entity environment="preset: midnight; ground: none; grid: none"></a-entity>
      <a-entity sound="src: #lobbyMusic; autoplay: true; loop: true; volume: 0.3"></a-entity>

      <a-entity id="main-building">
        <a-box id="floor" position="0 -0.05 0" width="50" height="0.1" depth="50" color="#111" static-body></a-box>
        <a-box id="ceiling" position="0 6 0" width="50" height="0.1" depth="50" color="#050505" static-body></a-box>

        <a-box position="0 3 -15" width="30" height="6" depth="0.5" src="#brickWall" repeat="6 2" static-body>
            <a-image src="#casinoArt" position="0 0 0.31" width="8" height="4.5"></a-image>
        </a-box>
        <a-box position="0 3 15" width="30" height="6" depth="0.5" src="#brickWall" repeat="6 2" static-body></a-box>
        <a-box position="-15 3 0" rotation="0 90 0" width="30" height="6" depth="0.5" src="#brickWall" repeat="6 2" static-body></a-box>
        <a-box position="15 3 0" rotation="0 90 0" width="30" height="6" depth="0.5" src="#brickWall" repeat="6 2" static-body></a-box>
      </a-entity>

      <a-entity id="game-zone" position="0 0 -22">
          <a-cylinder radius="1.6" height="0.1" scale="1.9 1 1" src="#feltTexture" static-body></a-cylinder>
          <a-torus rotation="90 0 0" radius="1.6" tube="0.15" scale="1.9 1 1" src="#leatherTexture"></a-torus>
          
          <a-entity id="win-display" position="0 2.5 0" visible="false">
              <a-text id="win-text" value="" align="center" color="yellow" width="10" scale="2 2 2"></a-text>
          </a-entity>
      </a-entity>

      <a-entity id="lobby-room">
          <a-entity position="0 3 -8">
              <a-text value="WALLET: $1500" align="center" color="#00FF00" width="7"></a-text>
          </a-entity>
          <a-entity id="daily-table" position="8 0 -8" class="clickable">
              <a-box width="2" height="1.2" depth="1.2" color="#004dcf" static-body>
                  <a-text value="DAILY PICK" align="center" position="0 0.8 0" width="4"></a-text>
              </a-box>
          </a-entity>
      </a-entity>

      <a-entity id="rig" position="0 0 5">
        <a-camera position="0 1.6 0">
            <a-cursor color="white" visible="false"></a-cursor>
        </a-camera>

        <a-entity id="leftHand" 
                  teleport-controls="cameraRig: #rig; teleportOrigin: a-camera; button: trigger; type: parabolic; curveHitColor: #00FFFF"
                  oculus-touch-controls="hand: left">
        </a-entity>

        <a-entity id="rightHand" 
                  laser-controls="hand: right"
                  raycaster="objects: .clickable; far: 10"
                  oculus-touch-controls="hand: right">
        </a-entity>
      </a-entity>

    </a-scene>

    <script>
      // Automatically Sit Player when near the poker table
      setInterval(() => {
        let rig = document.querySelector('#rig');
        let tablePos = new THREE.Vector3(0, 0, -22);
        if (rig.getAttribute('position').distanceTo(tablePos) < 4.5) {
          rig.setAttribute('position', {x: 0, y: -0.4, z: -20}); 
        }
      }, 1000);

      // Daily Pick Logic
      document.querySelector('#daily-table').addEventListener('click', () => {
        let prize = (Math.floor(Math.random() * 10) + 1) * 500;
        alert("Daily Pick: You received $" + prize);
      });

      // Win Notification Function (Silent Dealer)
      function showWinner(name) {
        let win = document.querySelector('#win-display');
        document.querySelector('#win-text').setAttribute('value', name + " WINS POT");
        win.setAttribute('visible', 'true');
        setTimeout(() => { win.setAttribute('visible', 'false'); }, 10000);
      }
    </script>
  </body>
</html>
