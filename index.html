<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Scarlett VR Poker — Scarlett 1.0</title>
  <style>
    html,body{margin:0;padding:0;overflow:hidden;background:#05070d;color:#eaf0ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #app{position:fixed;inset:0}
    canvas{display:block}
    /* Diagnostics HUD container */
    #scarlettHud{
      position:fixed; left:16px; top:16px; right:16px;
      max-width: 900px;
      background: rgba(18,26,54,0.92);
      border: 1px solid rgba(120,160,255,0.35);
      border-radius: 18px;
      padding: 16px 16px 12px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.55);
      z-index:999999;
      backdrop-filter: blur(8px);
    }
    #scarlettHud h1{margin:0 0 6px;font-size:22px;font-weight:700}
    #scarlettHud .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    #scarlettHud button{
      flex:1 1 140px;
      padding:14px 14px;
      border-radius: 12px;
      border: 1px solid rgba(120,160,255,0.35);
      background: rgba(40,70,160,0.35);
      color:#eaf0ff;
      font-size:16px;
    }
    #scarlettHud button:active{transform:scale(0.99)}
    #status{opacity:0.95;margin:0 0 10px}
    #logbox{
      margin-top:10px;
      padding:10px;
      border-radius: 12px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(120,160,255,0.25);
      max-height: 40vh;
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 12px;
      white-space: pre-wrap;
      line-height: 1.35;
    }
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- ALWAYS-ON DIAGNOSTICS HUD -->
  <div id="scarlettHud">
    <h1>Scarlett Diagnostics</h1>
    <div id="status">Booting…</div>
    <div class="row">
      <button id="btnHide">Hide HUD</button>
      <button id="btnCopy">Copy Logs</button>
      <button id="btnClear">Clear</button>
      <button id="btnReload">Reload</button>
    </div>
    <div id="logbox"></div>
  </div>

  <script>
    // --- Scarlett HUD logging (works even if boot never loads)
    (function(){
      const hud = document.getElementById('scarlettHud');
      const status = document.getElementById('status');
      const logbox = document.getElementById('logbox');
      const btnHide = document.getElementById('btnHide');
      const btnCopy = document.getElementById('btnCopy');
      const btnClear = document.getElementById('btnClear');
      const btnReload = document.getElementById('btnReload');

      const lines = [];
      const stamp = () => new Date().toLocaleTimeString();
      const push = (s) => {
        lines.push(`[${stamp()}] ${s}`);
        if(lines.length > 400) lines.shift();
        logbox.textContent = lines.join('\n');
        logbox.scrollTop = logbox.scrollHeight;
      };

      window.SCARLETT_DIAG = {
        setStatus: (s)=>{ status.textContent = s; push(`STATUS: ${s}`); },
        log: (...a)=>push(a.join(' ')),
        err: (...a)=>push('ERROR: ' + a.join(' ')),
        getText: ()=>lines.join('\n')
      };

      btnHide.onclick = ()=> hud.classList.add('hidden');
      // tap anywhere top-left corner to show again
      document.addEventListener('dblclick', ()=> hud.classList.remove('hidden'), {passive:true});

      btnCopy.onclick = async ()=>{
        try{
          await navigator.clipboard.writeText(window.SCARLETT_DIAG.getText());
          push('Copied logs to clipboard ✅');
        }catch(e){
          push('Copy failed (browser blocked clipboard)');
        }
      };
      btnClear.onclick = ()=>{ lines.length = 0; logbox.textContent=''; push('Logs cleared'); };
      btnReload.onclick = ()=> location.reload();

      // Base-path aware loader for GitHub Pages
      const href = location.href;
      const path = location.pathname; // e.g. /scarlett-poker-vr/
      // repo base = first segment
      const seg = path.split('/').filter(Boolean)[0];
      const base = seg ? `/${seg}/` : `/`;

      push(`href=${href}`);
      push(`path=${path}`);
      push(`base=${base}`);
      push(`secureContext=${window.isSecureContext}`);
      push(`ua=${navigator.userAgent}`);
      push(`navigator.xr=${!!navigator.xr}`);

      const bootUrl = `${base}js/scarlett1/boot.js?v=${Date.now()}`;
      push(`loading boot: ${bootUrl}`);

      const s = document.createElement('script');
      s.type = 'module';
      s.src = bootUrl;
      s.onload = ()=> push('boot loaded ✅');
      s.onerror = ()=> {
        window.SCARLETT_DIAG.err('boot FAILED to load ❌ (404 path or cache)');
        window.SCARLETT_DIAG.setStatus('Boot failed (check boot.js path)');
      };
      document.head.appendChild(s);

      // If after 2 seconds boot hasn’t touched status, show a warning
      setTimeout(()=>{
        if(status.textContent.trim() === 'Booting…'){
          push('boot not started yet… (likely wrong path)');
          window.SCARLETT_DIAG.setStatus('Boot not running (path mismatch)');
        }
      }, 2000);
    })();
  </script>
</body>
</html>
