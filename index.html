<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR 1.3 - Clean Luxury Build</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; }
    </style>
</head>
<body>
    <script type="importmap">
        { "imports": { 
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" 
        } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'three/addons/webxr/VRButton.js';
        import { XRControllerModelFactory } from 'three/addons/webxr/XRControllerModelFactory.js';

        // --- 1. CORE ENGINE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);
        document.body.appendChild(VRButton.createButton(renderer));

        // --- 2. VR PLAYER RIG (Crucial for Movement) ---
        const playerRig = new THREE.Group();
        playerRig.add(camera);
        scene.add(playerRig);
        // SPAWN POINT: Centered in the room (0, 0, 0)
        playerRig.position.set(0, 0, 0); 
        camera.position.y = 1.6; 

        // --- 3. LIGHTING ---
        const amb = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(amb);
        const sun = new THREE.DirectionalLight(0xffffff, 0.5);
        sun.position.set(5, 10, 5);
        scene.add(sun);

        // --- 4. THE CLEAN ROOM (4m Ceiling) ---
        const brickMat = new THREE.MeshStandardMaterial({ color: 0x8b2222 }); // Rich Red Brick
        const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.8, roughness: 0.2 });

        // Interior Floor
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(30, 30), new THREE.MeshStandardMaterial({color: 0x222222}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        // Interior Ceiling (4m high)
        const ceil = new THREE.Mesh(new THREE.PlaneGeometry(30, 30), new THREE.MeshStandardMaterial({color: 0x111111}));
        ceil.position.y = 4;
        ceil.rotation.x = Math.PI/2;
        scene.add(ceil);

        // Inside Walls
        const createWall = (x, z, w, r) => {
            const wall = new THREE.Mesh(new THREE.BoxGeometry(w, 4, 0.2), brickMat);
            wall.position.set(x, 2, z);
            wall.rotation.y = r;
            scene.add(wall);
        };
        createWall(0, -10, 20, 0);          // Front
        createWall(0, 10, 20, 0);           // Back
        createWall(-10, 0, 20, Math.PI/2);  // Left
        createWall(10, 0, 20, Math.PI/2);   // Right

        // Luxury Gold Pillars (Inside the corners)
        const createPillar = (x, z) => {
            const p = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 4, 16), goldMat);
            p.position.set(x, 2, z);
            scene.add(p);
        };
        createPillar(-9, -9); createPillar(9, -9);
        createPillar(-9, 9); createPillar(9, 9);

        // --- 5. CONTROLLERS & MOVEMENT ---
        const controllerModelFactory = new XRControllerModelFactory();
        
        // Setup Left Controller (For Movement)
        const controllerLeft = renderer.xr.getController(1);
        const gripLeft = renderer.xr.getControllerGrip(1);
        gripLeft.add(controllerModelFactory.createControllerModel(gripLeft));
        playerRig.add(controllerLeft, gripLeft);

        // Setup Right Controller (For "OK" Trigger)
        const controllerRight = renderer.xr.getController(0);
        const gripRight = renderer.xr.getControllerGrip(0);
        gripRight.add(controllerModelFactory.createControllerModel(gripRight));
        playerRig.add(controllerRight, gripRight);

        // Movement Logic (Thumbstick/Continuous)
        function handleMovement() {
            const session = renderer.xr.getSession();
            if (session) {
                for (const source of session.inputSources) {
                    if (source && source.gamepad && source.handedness === 'left') {
                        const axes = source.gamepad.axes; // [thumbstickX, thumbstickY]
                        // axes[2] and [3] are usually the thumbstick on Quest
                        const moveX = axes[2] || 0;
                        const moveZ = axes[3] || 0;
                        
                        // Basic movement relative to camera direction
                        const direction = new THREE.Vector3(moveX, 0, moveZ);
                        direction.applyQuaternion(camera.quaternion);
                        direction.y = 0; // Keep on floor
                        playerRig.position.addScaledVector(direction, 0.05);
                    }
                }
            }
        }

        // --- 6. RENDER LOOP ---
        renderer.setAnimationLoop(() => {
            handleMovement();
            renderer.render(scene, camera);
        });

    </script>
</body>
</html>
