<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SCARLETT POKER VR: TITAN EDITION</title>
    
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.11.0/dist/networked-aframe.min.js"></script>

    <style>
        body { background-color: #000; margin: 0; overflow: hidden; }
        #ui-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 10000; color: white;
            border: 15px solid #d4af37; box-sizing: border-box; font-family: 'Garamond', serif;
        }
        .logo-main { font-size: 4.5rem; color: #d4af37; text-shadow: 0 0 30px gold; margin: 0; letter-spacing: 12px; }
        .status-tag { color: #00ff00; font-family: monospace; letter-spacing: 3px; margin-top: 10px; }
        .enter-btn { 
            margin-top: 50px; padding: 25px 100px; background: gold; color: black; 
            font-weight: bold; font-size: 1.8rem; border: none; cursor: pointer;
            border-radius: 5px; box-shadow: 0 0 40px rgba(255, 215, 0, 0.5); transition: 0.3s;
        }
        .enter-btn:hover { background: white; transform: scale(1.05); }
    </style>

    <script>
        function initializeGame() {
            document.getElementById('ui-overlay').style.display = 'none';
            const scene = document.querySelector('a-scene');
            if (scene.audioListener) { scene.audioListener.context.resume(); }
        }

        // --- MASTER LOGIC: CHAT & POT ---
        AFRAME.registerComponent('master-logic', {
            init: function() {
                this.potValue = 0;
                this.messages = ["WELCOME TO THE ESTATE"];
                
                // Betting Logic
                this.el.addEventListener('place-bet', (e) => {
                    this.potValue += e.detail.amount;
                    document.querySelector('#pot-display').setAttribute('value', "POT: $" + this.potValue);
                    this.playTickSound();
                });

                // Chat Logic
                this.el.addEventListener('open-chat', () => {
                    let msg = prompt("Message to Room:");
                    if(msg) {
                        this.messages.push(msg.toUpperCase());
                        if(this.messages.length > 5) this.messages.shift();
                        document.querySelector('#chat-content').setAttribute('value', this.messages.join('\n'));
                    }
                });
            },
            playTickSound: function() {
                // Haptic feedback for VR controllers
                const rightHand = document.querySelector('#rightHand');
                if (rightHand && rightHand.components['tracked-controls']) {
                    rightHand.components['tracked-controls'].controller.gamepad.hapticActuators[0].pulse(0.5, 100);
                }
            }
        });

        // --- DRINK SYSTEM ---
        AFRAME.registerComponent('grab-drink', {
            init: function() {
                this.el.addEventListener('click', () => {
                    this.el.setAttribute('position', '0.1 -0.1 -0.3');
                    document.querySelector('#rightHand').appendChild(this.el);
                });
            }
        });
    </script>
</head>
<body>

    <div id="ui-overlay">
        <h1 class="logo-main">SCARLETT</h1>
        <p style="color: gold; font-style: italic; font-size: 1.5rem;">The Penthouse Estate</p>
        <p class="status-tag">‚óè ENCRYPTED CONNECTION ESTABLISHED</p>
        <button class="enter-btn" onclick="initializeGame()">ENTER LOUNGE</button>
    </div>

    <a-scene master-logic physics="debug: false; gravity: -9.81" 
             networked-scene="room: scarlet_estate_final; adapter: socketio; serverURL: https://naf-examples-server.glitch.me/; audio: true;">
        
        <a-assets>
            <template id="avatar-template">
                <a-entity class="avatar" networked-audio-source>
                    <a-gltf-model src="https://cdn.readyplayer.me/64b54e0b0e5132204a9e530a.glb" scale="1 1 1"></a-gltf-model>
                    <a-ring color="gold" radius-inner="0.4" radius-outer="0.45" rotation="-90 0 0" position="0 0.1 0" animation="property: scale; to: 1.2 1.2 1.2; dur: 800; dir: alternate; loop: true"></a-ring>
                </a-entity>
            </template>
        </a-assets>

        <a-sky color="#010101"></a-sky>
        <a-entity position="0 25 0" particle-system="preset: stars; color: gold; count: 3000"></a-entity>
        
        <a-plane static-body rotation="-90 0 0" width="100" height="100" color="#080808" material="roughness: 0.1; metalness: 0.9"></a-plane>

        <a-entity position="0 8 -25">
            <a-box width="50" height="20" depth="1" color="#111" material="opacity: 0.8">
                <a-box position="-15 -2 0.6" width="4" height="15" color="blue" opacity="0.3"></a-box>
                <a-box position="15 -5 0.6" width="5" height="10" color="purple" opacity="0.3"></a-box>
                <a-light type="rectLight" color="cyan" intensity="2" position="0 0 0.5" width="20" height="5"></a-light>
            </a-box>
        </a-entity>

        <a-entity position="-12 0 -6">
            <a-box static-body width="5" height="1.2" depth="1.5" color="#111">
                <a-text value="PRIVATE BAR" align="center" position="0 0.8 0.76" width="5" color="gold"></a-text>
            </a-box>
            <a-cylinder grab-drink class="clickable" position="0 1.4 0" radius="0.06" height="0.2" color="gold" material="opacity: 0.7; metalness: 1">
                <a-text value="DRINK" align="center" position="0 0.25 0" width="2"></a-text>
            </a-cylinder>
        </a-entity>

        <a-entity position="12 2 -6" rotation="0 -30 0">
            <a-plane class="clickable" onclick="this.sceneEl.emit('open-chat')" width="4" height="5" color="#222">
                <a-text value="--- SYSTEM LOG ---" align="center" position="0 2.2 0.01" width="5" color="gold"></a-text>
                <a-text id="chat-content" value="AWAITING INPUT..." align="center" position="0 0 0.01" width="4" color="white"></a-text>
                <a-text value="[ CLICK TO CHAT ]" align="center" position="0 -2.2 0.01" width="3" color="gold"></a-text>
            </a-plane>
        </a-entity>

        <a-entity position="0 0 -8">
            <a-cylinder static-body radius="4" height="1.2" color="#1a110a" material="roughness: 0.5"></a-cylinder>
            <a-cylinder static-body position="0 1.22 0" radius="3.7" height="0.1" color="#063d18"></a-cylinder>
            
            <a-text id="pot-display" value="POT: $0" position="0 2.8 0" align="center" width="10" color="gold" font="exo2bold" animation="property: scale; to: 1.05 1.05 1.05; dir: alternate; dur: 1000; loop: true"></a-text>

            <a-box class="clickable" onclick="this.sceneEl.emit('place-bet', {amount: 500})" position="1.5 1.4 1.5" width="0.6" height="0.2" depth="0.4" color="gold">
                <a-text value="BET $500" align="center" rotation="-90 0 0" position="0 0.11 0" width="3" color="black"></a-text>
            </a-box>
            
            <a-cylinder class="clickable" onclick="this.sceneEl.emit('victory-event')" position="-1.5 1.4 1.5" radius="0.25" height="0.1" color="white">
                <a-text value="WINNER" align="center" rotation="-90 0 0" position="0 0.06 0" width="3" color="black"></a-text>
            </a-cylinder>
        </a-entity>

        <a-entity position="-10 0 -15">
            <a-cylinder radius="0.8" height="15" color="#d4af37" material="metalness: 1; roughness: 0.1"></a-cylinder>
            <a-light type="point" color="gold" intensity="1" position="0 5 2"></a-light>
        </a-entity>
        <a-entity position="10 0 -15">
            <a-cylinder radius="0.8" height="15" color="#d4af37" material="metalness: 1; roughness: 0.1"></a-cylinder>
        </a-entity>

        <a-entity id="rig" position="0 0 5" movement-controls="controls: touch, keyboard; speed: 0.2;" kinematic-body networked="template:#avatar-template;attachTemplateToLocal:false;">
            <a-camera look-controls="pointerLockEnabled: false">
                <a-cursor color="gold" raycaster="objects: .clickable"></a-cursor>
            </a-camera>
            <a-entity id="leftHand" oculus-touch-controls="hand: left"></a-entity>
            <a-entity id="rightHand" oculus-touch-controls="hand: right" laser-controls="hand: right"></a-entity>
        </a-entity>

    </a-scene>
</body>
</html>
