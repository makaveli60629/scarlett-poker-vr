<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR Update 1.3 - Complete</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #win-ui {
            position: fixed; top: 15%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9); color: gold; padding: 30px;
            border: 3px solid #00f2ff; border-radius: 20px; display: none;
            text-align: center; z-index: 1000; font-family: sans-serif;
        }
    </style>
</head>
<body>
    <div id="win-ui"><h1 id="winner-name"></h1><p id="winner-hand"></p></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. Physics Engine (Capital P) ---
        class Physics {
            constructor() { this.colliders = []; }
            add(mesh) {
                const box = new THREE.Box3().setFromObject(mesh);
                this.colliders.push(box);
            }
            check(pos) {
                const playerSphere = new THREE.Sphere(pos, 0.4);
                for(let wall of this.colliders) {
                    if(wall.intersectsSphere(playerSphere)) return true;
                }
                return false;
            }
        }
        const P = new Physics();

        // --- 2. Setup Scene ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- 3. Lighting (Ensures no black screen) ---
        const amb = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(amb);

        // --- 4. Luxury Interior (Brick Walls & 4m Ceilings) ---
        const brickMat = new THREE.MeshStandardMaterial({ color: 0x4d1a1a }); // Dark Brick
        const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.8 });

        function createRoom(x, z, size, lightColor) {
            const room = new THREE.Group();
            // Floor & Ceiling (4m high)
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(size, size), new THREE.MeshStandardMaterial({color: 0x111111}));
            floor.rotation.x = -Math.PI/2;
            const ceil = new THREE.Mesh(new THREE.PlaneGeometry(size, size), new THREE.MeshStandardMaterial({color: 0x111111}));
            ceil.position.y = 4;
            ceil.rotation.x = Math.PI/2;
            room.add(floor, ceil);

            // Brick Walls
            const wallGeo = new THREE.BoxGeometry(size, 4, 0.2);
            const wall = new THREE.Mesh(wallGeo, brickMat);
            wall.position.set(0, 2, -size/2);
            room.add(wall);
            P.add(wall); // Solid walls

            // Luxury Pillar
            const pillar = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.2, 4), goldMat);
            pillar.position.set(-size/2 + 0.5, 2, -size/2 + 0.5);
            room.add(pillar);

            const light = new THREE.PointLight(lightColor, 2, 15);
            light.position.set(0, 3.8, 0);
            room.add(light);

            room.position.set(x, 0, z);
            scene.add(room);
        }

        createRoom(0, 0, 15, 0x00f2ff); // Lobby
        createRoom(18, 0, 12, 0x00ff00); // Poker Room
        createRoom(0, 18, 12, 0xffd700); // Vault

        // --- 5. Daily Pick Table ($500 increments) ---
        const dailyTable = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 1), goldMat);
        dailyTable.position.set(0, 0.5, -4);
        scene.add(dailyTable);
        P.add(dailyTable);

        // --- 6. Branded Poker Table ---
        const tableGroup = new THREE.Group();
        const tableTop = new THREE.Mesh(new THREE.CylinderGeometry(2.5, 2.5, 0.2), new THREE.MeshStandardMaterial({color: 0x076324}));
        tableTop.position.y = 0.8;
        const logo = new THREE.Mesh(new THREE.CircleGeometry(0.6, 32), new THREE.MeshBasicMaterial({color: 0xffffff}));
        logo.rotation.x = -Math.PI/2;
        logo.position.y = 0.91; 
        tableGroup.add(tableTop, logo);
        tableGroup.position.set(18, 0, 0);
        scene.add(tableGroup);

        // --- 7. Oculus Controls (OK Trigger) ---
        const controller1 = renderer.xr.getController(0); // Right
        scene.add(controller1);
        controller1.addEventListener('selectstart', () => {
            console.log("Right Trigger: OK Activated");
            // If near Daily Table, add $500
            if(camera.position.distanceTo(dailyTable.position) < 2) {
                console.log("Daily Pick Claimed!");
            }
        });

        // --- 8. Animation Loop ---
        renderer.setAnimationLoop(() => {
            renderer.render(scene, camera);
        });

    </script>
</body>
</html>
