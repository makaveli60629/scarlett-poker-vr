<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Scarlett VR Poker</title>
  <style>
    html,body { margin:0; padding:0; overflow:hidden; background:#000; touch-action:none; }
    #hud {
      position: fixed; left: 12px; top: 12px; right: 12px;
      color: #fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: rgba(0,0,0,0.58); border-radius: 18px; padding: 14px 16px;
      z-index: 9999;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    #hud .title { font-size: 34px; font-weight: 850; margin-bottom: 6px; letter-spacing: 0.2px; }
    #hud .sub { opacity: 0.92; line-height: 1.3; }
    #hud .row { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .btn {
      padding: 10px 12px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.55); color:#fff;
      font-size: 14px; font-weight: 650;
      user-select: none;
    }
    .btn:active { transform: translateY(1px); }

    #status {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.06);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 12px;
      white-space: pre-wrap;
      color: #bff;
    }

    #logWrap {
      position: fixed; left: 12px; right: 12px; bottom: 84px;
      z-index: 9999;
    }
    #log {
      color: #9ff; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      background: rgba(0,0,0,0.58); border-radius: 18px; padding: 12px;
      max-height: 38vh; overflow:auto; white-space: pre-wrap;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    #forceVR {
      position: fixed; right: 12px; bottom: 12px;
      padding: 14px 18px; border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.70); color:#fff;
      font-size: 16px; font-weight: 800;
      z-index: 2147483647;
      display:none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    /* Hide HUD/log in VR if you want later by adding a body class */
    body.vr #hud { display:none; }
    body.vr #logWrap { display:none; }
  </style>
</head>
<body>
  <div id="hud">
    <div class="title">Scarlett VR Poker</div>
    <div class="sub">
      <div><b>Quest:</b> tap <b>ENTER VR</b> (bottom-right).</div>
      <div><b>Move:</b> Left stick â€¢ <b>Snap turn:</b> Right stick â€¢ <b>Teleport:</b> Right trigger</div>
      <div><b>Android preview:</b> WebXR may not exist â€” youâ€™ll still see the world in 2D.</div>
    </div>

    <div class="row">
      <button class="btn" id="btnRecenter">Recenter</button>
      <button class="btn" id="btnToggleLog">Toggle Log</button>
      <button class="btn" id="btnReload">Reload</button>
      <button class="btn" id="btnFullscreen">Fullscreen</button>
      <button class="btn" id="btnCopyLog">Copy Log</button>
    </div>

    <div id="status">Status: bootingâ€¦</div>
  </div>

  <div id="logWrap">
    <div id="log">Bootingâ€¦</div>
  </div>

  <button id="forceVR">ENTER VR</button>

  <script type="module">
    const logEl = document.getElementById('log');
    const statusEl = document.getElementById('status');
    const forceBtn = document.getElementById('forceVR');
    const logWrap = document.getElementById('logWrap');

    // ======== BUILD VERSION (change this when you push an update) ========
    const BUILD = "9010";
    window.__BUILD_V = BUILD;

    // ======== HUD Logger used by main.js/world.js ========
    window.__hubLog = (m) => {
      const line = (typeof m === "string") ? m : JSON.stringify(m);
      logEl.textContent += "\n" + line;
      logEl.scrollTop = logEl.scrollHeight;
      console.log(line);
    };

    function setStatus(lines) {
      statusEl.textContent = lines.join("\n");
    }

    __hubLog("BOOT v=" + BUILD);

    // ======== Status ========
    const ua = navigator.userAgent || "";
    const isQuest = /OculusBrowser|Quest|Oculus/i.test(ua);
    const hasXR = !!navigator.xr;
    let supportedVR = false;

    setStatus([
      "Build: " + BUILD,
      "UA: " + (isQuest ? "Quest/OculusBrowser" : "Other"),
      "navigator.xr: " + (hasXR ? "true" : "false"),
      "immersive-vr: checkingâ€¦"
    ]);

    if (navigator.xr?.isSessionSupported) {
      try {
        supportedVR = await navigator.xr.isSessionSupported("immersive-vr");
      } catch {}
    }

    setStatus([
      "Build: " + BUILD,
      "UA: " + (isQuest ? "Quest/OculusBrowser" : "Other"),
      "navigator.xr: " + (hasXR ? "true" : "false"),
      "immersive-vr: " + (supportedVR ? "supported âœ…" : "not supported âš ï¸")
    ]);

    // ======== Import your main.js (cache-safe) ========
    try {
      await import(`./js/main.js?v=${encodeURIComponent(BUILD)}`);
      __hubLog("main.js loaded âœ…");
    } catch (e) {
      __hubLog("âŒ main import failed: " + (e?.message || e));
    }

    // ======== VRButton fallback ========
    // If VRButton doesn't appear within 1.2s on Quest, show a big fallback
    setTimeout(() => {
      const vrBtn = document.getElementById("VRButton");
      const shouldShowFallback = isQuest && supportedVR && (!vrBtn || vrBtn.offsetParent === null);
      if (shouldShowFallback) {
        forceBtn.style.display = "block";
        __hubLog("âš ï¸ VRButton not visible â†’ showing fallback ENTER VR button");
      }
    }, 1200);

    // The fallback button just clicks the real VRButton if it exists
    forceBtn.addEventListener("click", () => {
      const vrBtn = document.getElementById("VRButton");
      if (vrBtn) vrBtn.click();
      else __hubLog("âš ï¸ VRButton not found yet.");
    });

    // ======== Quick actions ========
    document.getElementById("btnToggleLog").addEventListener("click", () => {
      logWrap.style.display = (logWrap.style.display === "none") ? "block" : "none";
    });

    document.getElementById("btnReload").addEventListener("click", () => {
      location.reload();
    });

    document.getElementById("btnFullscreen").addEventListener("click", async () => {
      try {
        if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
        else await document.exitFullscreen();
      } catch (e) {
        __hubLog("âš ï¸ fullscreen failed: " + (e?.message || e));
      }
    });

    document.getElementById("btnCopyLog").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(logEl.textContent);
        __hubLog("âœ… log copied to clipboard");
      } catch {
        __hubLog("âš ï¸ clipboard blocked (browser policy)");
      }
    });

    // Recenter: tells main.js to re-face the table + reset teleport visuals if you implement it
    document.getElementById("btnRecenter").addEventListener("click", () => {
      window.dispatchEvent(new Event("scarlett-recenter"));
      __hubLog("ðŸ”„ recenter requested");
    });
  </script>
</body>
</html>
