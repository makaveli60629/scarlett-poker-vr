<!DOCTYPE html>
<html>
  <head>
    <title>Scarlett Poker VR - v1.3 FINAL</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="js/world-map.js"></script>
    <script src="js/logic.js"></script>
  </head>
  <body>
    <a-scene background="color: #020202">
      <a-assets>
        <img id="lobby-carpet" src="lobby_carpet.jpg">
        <img id="daily-claim-tex" src="dailyclaim.jpg">
        <img id="brand-logo" src="brand_logo.jpg">
        <img id="brick-wall" src="brickwall.jpg">
        <img id="checker-floor" src="Checker floor.jpg">
        <img id="poker-felt" src="https://cdn.glitch.global/green_felt.jpg">
      </a-assets>

      <a-light type="ambient" color="#555"></a-light>
      <a-light type="point" position="0 4 0" intensity="1"></a-light>

      <a-entity id="rig" position="0 0 0" movement-controls="speed: 0.15;">
        <a-entity camera look-controls position="0 1.6 0">
          <a-cursor color="cyan" raycaster="objects: .clickable"></a-cursor>
          
          <a-sphere radius="0.15" color="#e0ac69" position="0 0.05 0">
              <a-sphere radius="0.02" color="blue" position="0.05 0.05 -0.13"></a-sphere>
              <a-sphere radius="0.02" color="blue" position="-0.05 0.05 -0.13"></a-sphere>
          </a-sphere>
          <a-cylinder id="my-shirt" position="0 -0.8 0" radius="0.25" height="0.6" color="blue"></a-cylinder>
        </a-entity>
        
        <a-entity oculus-touch-controls="hand: left" hand-controls="hand: left; color: #e0ac69">
            <a-entity position="0 0.05 0.05" rotation="-90 0 0" poker-watch></a-entity>
        </a-entity>
        <a-entity oculus-touch-controls="hand: right" hand-controls="hand: right; color: #e0ac69" magnetic-grabber></a-entity>
      </a-entity>

      <a-entity id="world-container"></a-entity>

      <a-entity id="lobby-props">
          <a-entity position="-5 0 -2">
              <a-box width="1.2" height="0.1" depth="1.2" position="0 0.45 0" src="#daily-claim-tex">
                  <a-box class="clickable" daily-pick-logic position="0 0.1 0" width="0.3" height="0.1" depth="0.2" color="blue"></a-box>
              </a-box>
              <a-box width="1" height="0.8" depth="1" color="#111" position="0 0 0"></a-box>
          </a-entity>

          <a-entity id="zone-entrance" position="0 0 -8">
              <a-cylinder radius="1.2" height="10" position="0 5 0" material="color: #a020f0; opacity: 0.2; transparent: true"></a-cylinder>
              <a-circle class="clickable" teleport-logic="target: 100 0 102" rotation="-90 0 0" radius="1.2" color="#a020f0" opacity="0.6"></a-circle>
              
              <a-entity position="0 2.5 0.5">
                  <a-text value="TABLES ZONE ROOM" align="center" width="5" color="cyan"></a-text>
                  <a-text id="zone-wallet-display" value="CASH: $0" align="center" position="0 -0.5 0" width="4" color="yellow"></a-text>
              </a-entity>
          </a-entity>

          <a-entity position="7 0 5">
              <a-plane position="0 1.6 -1.9" width="1.5" height="2" color="#888" metalness="0.6"></a-plane>
              <a-box class="clickable" onclick="document.querySelector('#my-shirt').setAttribute('color', 'red')" position="-0.5 0.5 -1.5" width="0.3" height="0.3" color="red"></a-box>
              <a-box class="clickable" onclick="document.querySelector('#my-shirt').setAttribute('color', 'black')" position="0.5 0.5 -1.5" width="0.3" height="0.3" color="black"></a-box>
          </a-entity>
      </a-entity>

      <a-entity position="100 0 100">
          <a-entity position="0 0.8 0" geometry="primitive: cylinder; radius: 2.2; height: 0.1" scale="1.5 1 1" material="src: #poker-felt">
              <a-image src="#brand-logo" rotation="-90 0 0" position="0 0.06 0" width="1.5" height="1.5"></a-image>
          </a-entity>
          <a-entity class="clickable" auto-sit-logic position="0 0.1 2">
              <a-circle rotation="-90 0 0" radius="0.5" color="green" opacity="0.5"></a-circle>
              <a-text value="SIT TO PLAY" position="0 1 0" align="center"></a-text>
          </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // Builder logic
      const container = document.querySelector('#world-container');
      WORLD_MAP.rooms.forEach(room => {
          let roomGroup = document.createElement('a-entity');
          roomGroup.setAttribute('position', room.position);
          let floor = document.createElement('a-plane');
          floor.setAttribute('rotation', '-90 0 0');
          floor.setAttribute('width', room.floor.size.split(' ')[0]);
          floor.setAttribute('height', room.floor.size.split(' ')[1]);
          floor.setAttribute('src', room.floor.tex);
          floor.setAttribute('repeat', '5 5'); 
          roomGroup.appendChild(floor);
          room.walls.forEach(w => {
              let wall = document.createElement('a-box');
              wall.setAttribute('position', w.pos);
              wall.setAttribute('rotation', w.rot);
              wall.setAttribute('width', w.w);
              wall.setAttribute('height', w.h);
              wall.setAttribute('src', w.tex);
              roomGroup.appendChild(wall);
          });
          container.appendChild(roomGroup);
      });

      // Update Zone Hologram Wallet
      setInterval(() => {
          const val = localStorage.getItem('poker_wallet') || "1000";
          document.querySelector('#zone-wallet-display').setAttribute('value', "CASH: $" + val);
      }, 1000);
    </script>
  </body>
</html>
