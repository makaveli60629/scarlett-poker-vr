<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker VR 1.8 - Stabilized Base</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #444; }
        #canvas-container { width: 100vw; height: 100vh; }
        /* The VR Button MUST be visible and clickable */
        #VRButton { 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%);
            padding: 12px 24px !important;
            background: #000 !important;
            color: #fff !important;
            border: 1px solid #fff !important;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'three/addons/webxr/VRButton.js';
        import { XRControllerModelFactory } from 'three/addons/webxr/XRControllerModelFactory.js';

        let scene, camera, renderer, controller1, controller2;

        init();

        function init() {
            // 1. SCENE SETUP
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Sky Blue - if you see blue, the engine is working!

            // 2. CAMERA SETUP
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 3);

            // 3. RENDERER (The Critical Part)
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true; // Essential for Oculus
            document.body.appendChild(renderer.domElement);

            // 4. VR BUTTON - Added to body directly
            document.body.appendChild(VRButton.createButton(renderer));

            // 5. LIGHTING (Ultra Bright for Debugging)
            const ambient = new THREE.HemisphereLight(0xffffff, 0xbbbbbb, 3);
            scene.add(ambient);
            const directional = new THREE.DirectionalLight(0xffffff, 2);
            directional.position.set(5, 10, 5);
            scene.add(directional);

            // 6. PERMANENT OBJECTS (Colors only)
            createWorld();

            // 7. CONTROLLERS
            setupControllers();

            // START ENGINE
            renderer.setAnimationLoop(render);
        }

        function createWorld() {
            // FLOOR (Dark Grey)
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(20, 20),
                new THREE.MeshStandardMaterial({ color: 0x222222 })
            );
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // POKER TABLE (Forest Green)
            const table = new THREE.Mesh(
                new THREE.CylinderGeometry(1.2, 1.2, 0.2, 32),
                new THREE.MeshStandardMaterial({ color: 0x006400 })
            );
            table.position.set(0, 0.8, 0);
            scene.add(table);

            // WALLS (Brick Red)
            const wall = new THREE.Mesh(
                new THREE.BoxGeometry(10, 4, 0.2),
                new THREE.MeshStandardMaterial({ color: 0x8B0000 })
            );
            wall.position.set(0, 2, -5);
            scene.add(wall);

            // FLOOR TRIM (Black)
            const trim = new THREE.Mesh(
                new THREE.BoxGeometry(10, 0.1, 0.1),
                new THREE.MeshStandardMaterial({ color: 0x000000 })
            );
            trim.position.set(0, 0.05, -4.9);
            scene.add(trim);

            // EVENT CHIP ($5 Gold)
            const goldChip = new THREE.Mesh(
                new THREE.CylinderGeometry(0.04, 0.04, 0.02, 32),
                new THREE.MeshStandardMaterial({ color: 0xFFD700, metalness: 0.7, roughness: 0.2 })
            );
            goldChip.position.set(0, 0.92, -0.4);
            scene.add(goldChip);

            // THE TELEPHONE (Black Box)
            const phone = new THREE.Mesh(
                new THREE.BoxGeometry(0.2, 0.1, 0.2),
                new THREE.MeshStandardMaterial({ color: 0x111111 })
            );
            phone.position.set(1.4, 0.85, 0);
            scene.add(phone);
        }

        function setupControllers() {
            const controllerModelFactory = new XRControllerModelFactory();

            // Right
            controller1 = renderer.xr.getController(0);
            scene.add(controller1);
            const grip1 = renderer.xr.getControllerGrip(0);
            grip1.add(controllerModelFactory.createControllerModel(grip1));
            scene.add(grip1);

            // Left
            controller2 = renderer.xr.getController(1);
            scene.add(controller2);
            const grip2 = renderer.xr.getControllerGrip(1);
            grip2.add(controllerModelFactory.createControllerModel(grip2));
            scene.add(grip2);
        }

        function render() {
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
