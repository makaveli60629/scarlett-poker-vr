<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Brick Club VR - DNA COMPLETE</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        #overlay {
            position: absolute; width: 100%; height: 100%; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            background: #000; z-index: 100; color: #ffd700;
        }
        button {
            padding: 20px 60px; font-size: 24px; background: #8B0000;
            color: white; border: 2px solid #ffd700; border-radius: 50px; cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
    </style>
</head>
<body>
    <div id="overlay">
        <h1>BRICK CLUB CASINO</h1>
        <button id="start-btn">ENTER VR</button>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { VRButton } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/webxr/VRButton.js';
        
        // --- ALL DNA CATEGORIES LOADED ---
        import { initEngine, userRig } from './core/engine.js';
        import { buildLobby } from './world/lobby.js';
        import { setupOculus, updateLocomotion } from './core/controls.js';
        import { initAvatarStore } from './features/avatar.js';
        import { initPokerGame, checkTableProximity } from './features/poker-logic.js';

        let scene, camera, renderer;
        const tablePos = new THREE.Vector3(0, 0.8, -5); // The "Play Game" target

        async function start() {
            const engine = initEngine();
            scene = engine.scene;
            camera = engine.camera;
            renderer = engine.renderer;

            // Build the World & Features
            buildLobby(scene);
            initAvatarStore(scene, camera);
            initPokerGame(scene);
            setupOculus(renderer, scene, userRig);

            // THE MASTER LOOP
            renderer.setAnimationLoop(() => {
                // 1. Move the user
                updateLocomotion(renderer, userRig);
                
                // 2. Check if user walked to the poker table (Auto-Sit)
                checkTableProximity(userRig, tablePos, camera);
                
                // 3. Render the frame
                renderer.render(scene, camera);
            });
        }

        document.getElementById('start-btn').onclick = () => {
            document.getElementById('overlay').style.display = 'none';
            start();
        };
    </script>
</body>
</html>
