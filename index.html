<!DOCTYPE html>
<html>
  <head>
    <title>Scarlett Poker VR - v1.3 COMPLETE</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
    <script src="js/world-map.js"></script>
    <script src="js/logic.js"></script>
  </head>
  <body>
    <a-scene webxr="requiredFeatures: local-floor" background="color: #010101">
      <a-assets>
        <img id="lobby-carpet" src="lobby_carpet.jpg">
        <img id="brick-wall" src="brickwall.jpg">
        <img id="checker-floor" src="Checker floor.jpg">
        <img id="brand-logo" src="brand_logo.jpg">
        <img id="daily-claim-tex" src="dailyclaim.jpg">
      </a-assets>

      <a-light type="ambient" color="#555"></a-light>
      <a-light type="point" position="0 5 0" intensity="1.2"></a-light>

      <a-entity id="rig" position="0 0 0" movement-controls="controls: gamepad; speed: 0.2">
        <a-entity camera look-controls position="0 1.6 0">
          <a-cursor color="magenta"></a-cursor>
        </a-entity>
        <a-entity oculus-touch-controls="hand: left" hand-controls="hand: left"></a-entity>
        <a-entity oculus-touch-controls="hand: right" hand-controls="hand: right" magnetic-grabber></a-entity>
      </a-entity>

      <a-entity id="world-container"></a-entity>

      <a-entity position="-6 0 -3">
          <a-cylinder radius="0.8" height="0.1" color="#111"></a-cylinder>
          <a-entity position="0 1.2 0">
              <a-plane src="#daily-claim-tex" width="1.5" height="1" material="transparent: true; opacity: 0.8; side: double"
                       animation="property: position; to: 0 1.3 0; dir: alternate; loop: true; dur: 2000"></a-plane>
              <a-text value="CLICK TO CLAIM" align="center" position="0 -0.7 0" color="cyan" width="4"></a-text>
              <a-box class="clickable" daily-pick-logic position="0 -0.4 0" width="0.4" height="0.1" depth="0.2" color="blue"
                     animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear"></a-box>
          </a-entity>
      </a-entity>

      <a-entity position="6 0 -3">
          <a-box width="2" height="3" depth="0.5" color="#222" material="metalness: 0.8">
              <a-text value="STORE" align="center" position="0 1.2 0.26" color="#00FF00" width="10" 
                      material="shader: msdf; font:https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/berkshireswash/BerkshireSwash-Regular.json"></a-text>
              <a-plane position="0 0 0.27" width="1.8" height="2" color="#111"></a-plane>
          </a-box>
      </a-entity>

      <a-entity id="teleport-stage" position="0 0 -8">
          <a-ring rotation="-90 0 0" radius-inner="1.2" radius-outer="1.5" color="#bc13fe" 
                  material="emissive: #bc13fe; emissiveIntensity: 2"></a-ring>
          <a-ring rotation="-90 0 0" radius-inner="1.2" radius-outer="1.5" position="0 4 0" color="#bc13fe" 
                  material="emissive: #bc13fe; emissiveIntensity: 2"></a-ring>
          
          <a-entity class="clickable" teleport-logic="target: 100 0 102">
              <a-cylinder radius="1.2" height="4" position="0 2 0" color="#bc13fe" opacity="0.15" transparent="true"></a-cylinder>
              <a-text value="SCORPION ROOM" align="center" position="0 2.5 0" width="8" color="#bc13fe"
                      animation="property: opacity; from: 0.5; to: 1; dir: alternate; loop: true; dur: 1000"></a-text>
          </a-entity>
      </a-entity>

      <a-entity position="0 0 8">
          <a-plane position="0 1.6 -0.5" width="2" height="2.5" color="#999" material="metalness: 0.9; roughness: 0.1"></a-plane>
          <a-text value="AVATAR MIRROR" position="0 3 0" align="center" width="5"></a-text>
      </a-entity>

    </a-scene>

    <script>
      const container = document.querySelector('#world-container');
      WORLD_MAP.rooms.forEach(room => {
          let roomGroup = document.createElement('a-entity');
          roomGroup.setAttribute('position', room.position);
          let floor = document.createElement('a-plane');
          floor.setAttribute('rotation', '-90 0 0');
          floor.setAttribute('width', room.floor.size.split(' ')[0]);
          floor.setAttribute('height', room.floor.size.split(' ')[1]);
          floor.setAttribute('src', room.floor.tex);
          floor.setAttribute('repeat', '4 4'); 
          roomGroup.appendChild(floor);
          room.walls.forEach(w => {
              let wall = document.createElement('a-box');
              wall.setAttribute('position', w.pos);
              wall.setAttribute('rotation', w.rot);
              wall.setAttribute('width', w.w);
              wall.setAttribute('height', w.h);
              wall.setAttribute('src', w.tex);
              roomGroup.appendChild(wall);
          });
          container.appendChild(roomGroup);
      });
    </script>
  </body>
</html>
