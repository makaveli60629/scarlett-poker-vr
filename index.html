<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Skylark Poker VR</title>
  <style>
    html, body { margin:0; padding:0; height:100%; background:#05060a; color:#e9eefc; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #app { position: fixed; inset: 0; }
    canvas { display:block; width:100%; height:100%; }
    #hud {
      position: fixed; inset: 12px auto auto 12px; z-index: 999999;
      width: min(92vw, 820px);
      background: rgba(10,12,18,.86);
      border: 1px solid rgba(0,255,170,.35);
      border-radius: 12px;
      padding: 12px 14px;
      backdrop-filter: blur(6px);
    }
    #title { font-weight:800; letter-spacing:.2px; font-size: 16px; margin:0 0 6px; }
    #status { display:flex; gap:10px; align-items:center; margin: 0 0 8px; flex-wrap: wrap; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;
    }
    .ok { border-color: rgba(0,255,170,.35); }
    .bad { border-color: rgba(255,60,120,.35); }
    #log {
      white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.35;
      margin: 0;
      max-height: 45vh;
      overflow:auto;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
    }
    a { color:#7af; }
  </style>
</head>

<body>
  <div id="app"></div>

  <div id="hud">
    <div id="title">Skylark Poker VR</div>
    <div id="status">
      <span id="htmlPill" class="pill ok">‚úÖ HTML loaded</span>
      <span id="jsPill" class="pill bad">‚è≥ JS booting‚Ä¶</span>
      <span id="pathPill" class="pill">üìç path: <span id="pathTxt"></span></span>
    </div>
    <pre id="log">Waiting for main.js‚Ä¶</pre>
  </div>

  <script>
    const logEl = document.getElementById("log");
    const jsPill = document.getElementById("jsPill");
    const pathTxt = document.getElementById("pathTxt");
    pathTxt.textContent = location.pathname;

    function log(line) {
      logEl.textContent = (logEl.textContent === "Waiting for main.js‚Ä¶" ? "" : logEl.textContent + "\n") + line;
    }

    window.addEventListener("error", (e) => {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "‚ùå ERROR";
      log("ERROR: " + (e.message || e.error || "Unknown"));
      if (e.filename) log("FILE: " + e.filename + ":" + e.lineno + ":" + e.colno);
    });

    window.addEventListener("unhandledrejection", (e) => {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "‚ùå IMPORT FAILED";
      log("PROMISE REJECTION:");
      log(String(e.reason?.stack || e.reason || e));
    });

    log("Tip: reload with ?v=" + Date.now());
  </script>

  <script type="module">
    const jsPill = document.getElementById("jsPill");
    const logEl = document.getElementById("log");
    const log = (line) => { logEl.textContent += (logEl.textContent ? "\n" : "") + line; };

    async function tryImport(url) {
      log("Trying import: " + url);
      return await import(url);
    }

    try {
      // Try common GitHub Pages layouts:
      // 1) index.html is inside /scarlett-poker-vr/  -> ./js/main.js works
      // 2) index.html is at root and game is in /scarlett-poker-vr/ -> ./scarlett-poker-vr/js/main.js works
      const candidates = [
        new URL("./js/main.js", location.href).href,
        new URL("./scarlett-poker-vr/js/main.js", location.href).href,
      ];

      let mod = null;
      let lastErr = null;

      for (const u of candidates) {
        try { mod = await tryImport(u); break; }
        catch (e) { lastErr = e; }
      }

      if (!mod) throw lastErr || new Error("Failed to import main.js from all candidates.");

      if (typeof mod.boot === "function") {
        await mod.boot();
        jsPill.classList.remove("bad"); jsPill.classList.add("ok");
        jsPill.textContent = "‚úÖ boot() ok";
        log("main.js boot() executed.");
      } else {
        jsPill.classList.remove("bad"); jsPill.classList.add("ok");
        jsPill.textContent = "‚úÖ main.js loaded";
        log("main.js imported (no boot export).");
      }
    } catch (err) {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "‚ùå IMPORT FAILED";
      log("IMPORT ERROR:");
      log(String(err?.stack || err));
      throw err;
    }
  </script>
</body>
</html>
