<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Scorpion Poker VR â€” 2.0.1 PERMANENT HANDS</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>

  <script>
    AFRAME.registerComponent('scorpion-logic', {
      tick: function () {
        // Clock Update
        const timeDisplay = document.querySelector('#timeDisplay');
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');
        if(timeDisplay) timeDisplay.setAttribute('text', 'value', 'TIME: ' + timeStr);
        
        // Store Portal Logic
        const rigPos = document.querySelector('#rig').object3D.position;
        if (rigPos.x > 11 && Math.abs(rigPos.z) < 2) {
           document.querySelector('#rig').setAttribute('position', '25 0 0');
        }
      }
    });

    // FORCE HANDS ONLY COMPONENT
    AFRAME.registerComponent('force-hands', {
      init: function () {
        const el = this.el;
        // Listen for either hand tracking or controller connection
        el.addEventListener('model-loaded', () => {
          this.applySkin();
        });
      },
      applySkin: function() {
        const mesh = this.el.getObject3D('mesh');
        if (mesh) {
          mesh.traverse(node => {
            if (node.isMesh) {
              node.material.color.set('#d2b48c');
              node.visible = true; // Ensure hand is always visible
            }
          });
        }
      },
      tick: function() {
        // Double check visibility to ensure controllers don't override
        const controllerModel = this.el.getObject3D('controller-bundle');
        if (controllerModel) controllerModel.visible = false;
      }
    });

    // Menu Toggle Logic
    window.addEventListener('pinchstart', (evt) => {
        if(evt.detail.hand === 'left') {
            const m = document.querySelector('#menuPanel');
            m.setAttribute('visible', !m.getAttribute('visible'));
        }
    });
  </script>
</head>

<body>
<a-scene scorpion-logic physics="gravity: 0">
  
  <a-sky color="#05000a"></a-sky>
  <a-light type="ambient" intensity="1"></a-light>

  <a-plane id="floor" rotation="-90 0 0" width="100" height="100" color="#111" static-body></a-plane>

  <a-box position="0 2.5 -12" width="24" height="5" depth="0.5" color="#8B0000" static-body>
    <a-box position="0 -2.4 0.3" width="24.1" height="0.2" depth="0.1" color="#000"></a-box>
  </a-box>
  <a-box position="0 2.5 12" width="24" height="5" depth="0.5" color="#8B0000" static-body></a-box>
  <a-box position="-12 2.5 0" width="0.5" height="5" depth="24" color="#8B0000" static-body></a-box>
  <a-box position="12 2.5 0" width="0.5" height="5" depth="24" color="#8B0000" static-body></a-box>

  <a-entity position="0 4 -11.4">
    <a-plane width="5" height="2.5" color="#000"></a-plane>
    <a-text value="TOP SCORPIONS" align="center" position="0 1 0.1" color="#FFD700" width="8"></a-text>
    <a-text value="QUEEN AURELIUS - $1.2M\nSCORPION ACE - $850K" align="center" position="0 -0.2 0.1" color="#00ffff" width="5"></a-text>
  </a-entity>

  <a-cylinder position="0 0.8 -3" radius="1.5" height="0.4" color="#004422" static-body></a-cylinder>

  <a-entity id="rig" position="0 0 7" kinematic-body>
    <a-entity id="camera" camera look-controls position="0 1.6 0">
      <a-entity position="0 0 -1">
         <a-text id="cashDisplay" value="CASH: $5,000" color="#00ff00" scale="0.15 0.15 0.15" position="-0.6 0.4 0"></a-text>
         <a-text id="timeDisplay" value="TIME: 00:00" color="#00ffff" scale="0.15 0.15 0.15" position="0.4 0.4 0"></a-text>
      </a-entity>
    </a-entity>

    <a-entity id="leftHand" 
              hand-tracking-controls="hand: left" 
              hand-controls="hand: left; handModelStyle: highPoly; color: #d2b48c"
              force-hands>
      <a-entity id="menuPanel" visible="false" position="0 0.2 -0.2" rotation="-40 0 0">
        <a-plane width="0.4" height="0.5" color="#001a33" opacity="0.9">
          <a-text value="SCORPION MENU" align="center" position="0 0.2 0" width="1"></a-text>
          <a-text value="CLAIM $500" align="center" position="0 0.05 0" width="0.8" color="#FFD700"></a-text>
          <a-text value="STATS" align="center" position="0 -0.1 0" width="0.8"></a-text>
        </a-plane>
      </a-entity>
    </a-entity>

    <a-entity id="rightHand" 
              hand-tracking-controls="hand: right" 
              hand-controls="hand: right; handModelStyle: highPoly; color: #d2b48c"
              force-hands
              blink-controls="cameraRig: #rig; teleportOrigin: #camera; collisionEntities: #floor; type: line; lineColor: #FFD700; cursorColor: #FFD700">
    </a-entity>
  </a-entity>

</a-scene>
</body>
</html>
