<!DOCTYPE html>
<html>
  <head>
    <title>Scarlett Poker VR - v1.3 MASTER</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="js/world-map.js"></script>
    <script src="js/logic.js"></script>
    <script src="js/ui-holograms.js"></script>
  </head>
  <body>
    <a-scene background="color: #020202">
      <a-assets>
        <img id="checker-floor" src="Checker floor.jpg">
        <img id="brick-wall" src="https://cdn.glitch.global/brick_texture.jpg">
        <img id="poker-felt" src="https://cdn.glitch.global/green_felt.jpg">
        <audio id="click-snd" src="https://cdn.aframe.io/360-video-example/guisize.mp4"></audio>
      </a-assets>

      <a-light type="ambient" color="#666"></a-light>
      <a-light type="point" intensity="1" position="0 4 0"></a-light>

      <a-entity id="rig" position="0 0 0" movement-controls="speed: 0.2;">
        <a-entity camera look-controls position="0 1.6 0">
          <a-cursor color="cyan" raycaster="objects: .clickable"></a-cursor>
          
          <a-sphere radius="0.15" color="#e0ac69" position="0 0.05 0"></a-sphere>
          <a-cylinder id="my-shirt" position="0 -0.8 0" radius="0.25" height="0.6" color="blue"></a-cylinder>

          <a-entity id="hud-msg" position="0 0 -0.5" scale="0.2 0.2 0.2" visible="false">
             <a-plane color="black" width="3" height="1"></a-plane>
             <a-text id="hud-text" align="center" color="yellow"></a-text>
          </a-entity>
        </a-entity>
        
        <a-entity oculus-touch-controls="hand: left" hand-controls="hand: left; color: #e0ac69">
            <a-entity position="0 0.05 0.05" rotation="-90 0 0" poker-watch>
                <a-plane width="0.12" height="0.12" color="#111"></a-plane>
                <a-text id="watch-text" align="center" width="0.3" color="cyan"></a-text>
                <a-plane class="clickable" teleport-logic="target: 0 0 0" position="0 -0.04 0.02" width="0.08" height="0.03" color="red">
                    <a-text value="LOBBY" align="center" width="0.2"></a-text>
                </a-plane>
            </a-entity>
        </a-entity>
        
        <a-entity oculus-touch-controls="hand: right" hand-controls="hand: right; color: #e0ac69" magnetic-grabber sound="src: #click-snd; on: click"></a-entity>
      </a-entity>

      <a-entity id="world-container"></a-entity>

      <a-entity id="lobby-props">
          <a-entity position="7 0 5">
              <a-plane position="0 1.6 -1.9" width="1.5" height="2" color="#888" metalness="0.8"></a-plane>
              <a-box class="clickable shirt-swatch" data-color="red" position="-0.5 1 -1.5" width="0.3" height="0.3" color="red"></a-box>
              <a-box class="clickable shirt-swatch" data-color="black" position="0 1 -1.5" width="0.3" height="0.3" color="black"></a-box>
          </a-entity>

          <a-entity position="-5 0 0">
              <a-box width="1.5" height="0.8" depth="0.8" color="#333">
                  <a-box class="clickable" daily-pick-logic position="0 0.45 0" width="0.4" height="0.1" depth="0.3" color="blue"></a-box>
              </a-box>
          </a-entity>

          <a-entity position="0 0.05 -7">
              <a-circle rotation="-90 0 0" radius="1" color="orange" opacity="0.5"></a-circle>
              <a-entity class="clickable" teleport-logic="target: 100 0 100" position="0 1 0">
                  <a-text value="TO SCORPION" align="center" width="5"></a-text>
              </a-entity>
          </a-entity>
      </a-entity>

    </a-scene>

    <script>
      const container = document.querySelector('#world-container');
      WORLD_MAP.rooms.forEach(room => {
          let roomGroup = document.createElement('a-entity');
          roomGroup.setAttribute('position', room.position);
          let floor = document.createElement('a-plane');
          floor.setAttribute('rotation', '-90 0 0');
          floor.setAttribute('width', room.floor.size.split(' ')[0]);
          floor.setAttribute('height', room.floor.size.split(' ')[1]);
          floor.setAttribute('src', room.floor.tex);
          floor.setAttribute('repeat', '10 10');
          roomGroup.appendChild(floor);
          room.walls.forEach(w => {
              let wall = document.createElement('a-box');
              wall.setAttribute('position', w.pos);
              wall.setAttribute('rotation', w.rot);
              wall.setAttribute('width', w.w);
              wall.setAttribute('height', w.h);
              wall.setAttribute('src', w.tex);
              roomGroup.appendChild(wall);
          });
          container.appendChild(roomGroup);
      });

      document.querySelectorAll('.shirt-swatch').forEach(swatch => {
          swatch.addEventListener('click', () => {
              document.querySelector('#my-shirt').setAttribute('color', swatch.getAttribute('data-color'));
          });
      });
    </script>
  </body>
</html>
