<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Skylark Poker VR</title>
  <style>
    html, body { margin:0; padding:0; background:#000; color:#fff; overflow:hidden; height:100%; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #hud {
      position: fixed; left: 12px; top: 12px; z-index: 20;
      background: rgba(0,0,0,0.65); border: 1px solid rgba(255,255,255,0.15);
      border-radius: 12px; padding: 12px 14px; max-width: 92vw;
      box-shadow: 0 8px 24px rgba(0,0,0,0.35);
    }
    #title { font-weight: 800; font-size: 18px; margin-bottom: 6px; }
    #status { font-size: 14px; opacity: 0.95; }
    #err { margin-top: 10px; font-size: 13px; color: #ff6b6b; white-space: pre-wrap; }

    /* VR button corner */
    #vrCorner { position: fixed; right: 12px; top: 12px; z-index: 30; }

    /* Mobile controls bar */
    #mobileBar {
      position: fixed; left: 12px; right: 12px; bottom: 12px; z-index: 25;
      display: flex; align-items: center; gap: 10px; justify-content: flex-end;
      pointer-events: none;
    }
    .btn {
      pointer-events: auto;
      background: rgba(30,30,30,0.78);
      border: 1px solid rgba(255,255,255,0.18);
      color: #fff;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 14px;
      user-select: none;
    }
    #stick {
      pointer-events: auto;
      width: 130px; height: 130px;
      border-radius: 999px;
      background: rgba(30,30,30,0.55);
      border: 1px solid rgba(255,255,255,0.12);
      margin-right: auto;
      position: relative;
      overflow: hidden;
    }
    #stickDot {
      position:absolute; left:50%; top:50%;
      width: 34px; height: 34px; border-radius: 999px;
      transform: translate(-50%,-50%);
      background: rgba(100,200,255,0.65);
      border: 1px solid rgba(255,255,255,0.25);
    }

    canvas { display:block; }
  </style>
</head>
<body>

  <div id="hud">
    <div id="title">Skylark Poker VR</div>
    <div id="status">If you see this text, HTML loaded ✅<br/>Status: loading…</div>
    <div id="err"></div>
  </div>

  <!-- IMPORTANT: VR button mounts here -->
  <div id="vrCorner"></div>

  <!-- Mobile buttons -->
  <div id="mobileBar">
    <div id="stick"><div id="stickDot"></div></div>
    <button class="btn" id="btnReset">Reset</button>
    <button class="btn" id="btnAudio">Audio</button>
    <button class="btn" id="btnMenu">Menu</button>
  </div>

  <script type="module">
    const statusEl = document.getElementById("status");
    const errEl = document.getElementById("err");
    const vrCorner = document.getElementById("vrCorner");

    // Hard fail if missing
    if (!statusEl || !errEl || !vrCorner) {
      document.body.innerHTML = "<pre style='color:red'>FATAL: HUD elements missing in index.html</pre>";
      throw new Error("HUD elements missing");
    }

    // Show better errors on-screen
    function showErr(e) {
      const msg = (e && e.stack) ? e.stack : String(e);
      errEl.textContent = msg;
      statusEl.innerHTML = "Status: IMPORT FAILED ❌<br/>Fix: confirm EXACT path <b>js/main.js</b> (lowercase) committed.";
    }

    window.addEventListener("error", (e) => showErr(e.error || e.message));
    window.addEventListener("unhandledrejection", (e) => showErr(e.reason || e));

    // Quick WebXR hint
    const isSecure = window.isSecureContext;
    const hasXR = !!navigator.xr;
    statusEl.innerHTML =
      `If you see this text, HTML loaded ✅<br/>Status: loading…<br/>` +
      `HTTPS: ${isSecure ? "✅" : "❌"} | WebXR: ${hasXR ? "✅" : "❌"}`;

    // MOBILE UI hooks (these won’t break VR if you don’t use them yet)
    document.getElementById("btnReset").onclick = () => location.reload();
    document.getElementById("btnAudio").onclick = () => window.dispatchEvent(new CustomEvent("toggle-audio"));
    document.getElementById("btnMenu").onclick = () => window.dispatchEvent(new CustomEvent("toggle-menu"));

    // Import main + boot
    try {
      statusEl.innerHTML += "<br/>Trying to import: <code> /js/main.js</code>";
      const mod = await import("./js/main.js");

      if (!mod || typeof mod.boot !== "function") {
        throw new Error("main.js loaded but did not export boot(). Make sure it has: export async function boot(...)");
      }

      statusEl.innerHTML = "HTML loaded ✅<br/>Status: main.js loaded ✅<br/>Creating VR button…";

      // IMPORTANT: pass vrCorner so VRButton has a real mount
      await mod.boot({ statusEl, errEl, vrCorner });

      statusEl.innerHTML = "HTML loaded ✅<br/>Status: running ✅ (Look top-right for ENTER VR)";
    } catch (e) {
      showErr(e);
    }
  </script>
</body>
</html>
