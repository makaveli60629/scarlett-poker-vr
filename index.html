<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <title>Scarlett Poker VR — Boot</title>

  <!-- Import map (so modules can import 'three') -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/"
    }
  }
  </script>

  <style>
    html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    #app{position:fixed;inset:0;}
    #hud{
      position:fixed;left:10px;top:10px;z-index:999999;
      width:calc(100vw - 20px);max-width:980px;max-height:56vh;overflow:auto;
      padding:10px 12px;border-radius:12px;
      background:rgba(0,0,0,.72);border:1px solid rgba(0,255,120,.75);
      color:rgba(0,255,120,.95);
      font:12px/1.35 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      white-space:pre-wrap;word-break:break-word;
    }
    #bar{
      position:fixed;left:10px;top:calc(56vh + 22px);z-index:999999;
      display:flex;flex-wrap:wrap;gap:8px;
      padding:8px;border-radius:14px;
      background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.15);
      backdrop-filter: blur(6px);
    }
    .btn{
      appearance:none;cursor:pointer;touch-action:manipulation;
      padding:10px 12px;border-radius:12px;
      background:rgba(255,255,255,.08);color:#fff;
      border:1px solid rgba(255,255,255,.18);
      font-weight:650;font-size:14px;
    }
    .pill{
      align-self:center;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.06);
      color:rgba(255,255,255,.85);
      font-size:12px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <div id="hud">BOOT HUD: starting…</div>

  <div id="bar">
    <button id="reload" class="btn">Reload (fresh)</button>
    <button id="clear" class="btn">Clear HUD</button>
    <button id="audit" class="btn">Audit</button>
    <span id="pill" class="pill">status: booting</span>
  </div>

  <script>
    (function(){
      const hud = document.getElementById('hud');
      const pill = document.getElementById('pill');
      const ts = () => new Date().toISOString().slice(11,19);

      function log(m){
        hud.textContent += `\n[${ts()}] ${m}`;
        hud.scrollTop = hud.scrollHeight;
      }
      function status(s){ pill.textContent = `status: ${s}`; }

      window.__bootlog = log;
      window.__bootstatus = status;

      window.addEventListener('error', (e)=>{
        log('ERROR: ' + (e?.message || e?.error || e));
        if (e?.filename) log('FILE: ' + e.filename + (e.lineno ? `:${e.lineno}:${e.colno}` : ''));
        status('error');
      });
      window.addEventListener('unhandledrejection', (e)=>{
        const r = e?.reason;
        log('PROMISE: ' + (r?.message || r || e));
        status('promise error');
      });

      document.getElementById('reload').addEventListener('click', ()=>{
        const u = new URL(location.href);
        u.searchParams.set('v', String(Date.now()));
        location.replace(u.toString());
      });
      document.getElementById('clear').addEventListener('click', ()=>{
        hud.textContent = 'BOOT HUD: cleared';
        log('Cleared.');
      });
      document.getElementById('audit').addEventListener('click', ()=>{
        if (typeof window.__runAudit === 'function') window.__runAudit();
        else log('Audit not ready yet.');
      });

      log('[index] boot ✅');
      log('[env] secureContext=' + (location.protocol === 'https:' || location.hostname === 'localhost'));
      log('[env] ua=' + navigator.userAgent);
      log('[env] navigator.xr=' + ('xr' in navigator));
      status('loading boot.js');
    })();
  </script>

  <script type="module">
    __bootlog('[index] importing /boot.js …');
    import('./boot.js?v=' + Date.now())
      .then(()=> { __bootlog('[index] boot.js loaded ✅'); __bootstatus('running'); })
      .catch((e)=> {
        __bootlog('[index] boot.js FAILED ❌ ' + (e?.message || e));
        console.error(e);
        __bootstatus('boot failed');
      });
  </script>
</body>
</html>
