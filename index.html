<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCORIPON ELITE - FINAL PERMANENT MASTER</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>
    
    <script>
        // --- FELT SHADER (Modular Logic) ---
        AFRAME.registerShader('poker-felt-shader', {
            schema: { color: {type: 'color', is: 'uniform', default: '#076324'} },
            vertexShader: `varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
            fragmentShader: `
                varying vec2 vUv; uniform vec3 color;
                float noise(vec2 p) { return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453); }
                void main() { float n = noise(vUv * 500.0); gl_FragColor = vec4(color + (n * 0.05), 1.0); }`
        });

        // --- CORE POKER & UI LOGIC ---
        AFRAME.registerComponent('poker-master', {
            init: function () {
                this.balance = 5000;
                this.rank = "SCORIPON ELITE";
                this.startTime = Date.now();
                this.playerEl = document.querySelector('#player');
                this.watchText = document.querySelector('#watch-stats');
                this.boardText = document.querySelector('#leaderboard-text');
                this.winUI = document.querySelector('#winner-overlay');
                
                // Safe Spawn (Memory Rule)
                this.playerEl.setAttribute('position', "0 0 5"); 
                setInterval(() => { this.updateAllUIs(); }, 1000);
            },
            updateAllUIs: function() {
                const now = new Date();
                const timeStr = now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
                const sessionStr = `${timeStr}\n$${this.balance}\n${this.rank}`;
                this.watchText.setAttribute('value', sessionStr);
                this.boardText.setAttribute('value', `CASINO LEADERBOARD\nBANK: $${this.balance}\nRANK: ${this.rank}`);
            },
            sitPlayer: function() {
                this.playerEl.setAttribute('position', "0 0.6 -1.5");
                this.triggerWinEffect("SEATED", "HANDS IN PLAY");
            },
            triggerWinEffect: function(msg, hand) {
                this.winUI.setAttribute('visible', true);
                document.querySelector('#win-text').setAttribute('value', `${msg}\n${hand}`);
                // Player Pulse Highlight (Update 1.3 Requirement)
                this.playerEl.setAttribute('animation', "property: scale; to: 1.05 1.05 1.05; dur: 300; loop: 4; dir: alternate");
                setTimeout(() => { 
                    this.winUI.setAttribute('visible', false);
                    this.playerEl.setAttribute('scale', "1 1 1");
                }, 10000); // Strict 10-second win display
            }
        });
    </script>
</head>
<body>
    <a-scene poker-master renderer="antialias: true; colorManagement: true;">
        
        <a-assets timeout="3000">
            <img id="card-back" src="assets/textures/Card back.jpg">
            <img id="casino-art-2" src="assets/textures/Casinoart2.jpg">
            <img id="marble-gold-floor" src="assets/textures/Marblegold floors.jpg">
            <img id="room-brand" src="assets/textures/Scoripon room brand.jpg">
            <img id="table-trim" src="assets/textures/Table leather trim.jpg">
            <img id="teleport-glow" src="assets/textures/Teleport glow.jpg">
            <img id="winner-tex" src="assets/textures/Winner.jpg">
            <img id="sky-tex" src="assets/textures/casino_sky.jpg">
        </a-assets>

        <a-entity id="player">
            <a-camera id="cam" look-controls><a-cursor color="red" fuse="false"></a-cursor></a-camera>
            
            <a-entity id="leftHand" 
                      hand-tracking-controls="hand: left; modelColor: #e0ac69;"
                      oculus-touch-controls="hand: left"
                      blink-controls="cameraRig: #player; teleportOrigin: #cam; collisionEntities: .nav-mesh; snapImage: #teleport-glow;">
                <a-entity id="watch" position="0 0.06 0.08" rotation="-90 0 0">
                    <a-box width="0.1" height="0.12" depth="0.02" color="#111">
                        <a-text id="watch-stats" value="" color="#0FF" scale="0.12 0.12 0.12" position="0 0.02 0.012" align="center"></a-text>
                        <a-circle radius="0.02" color="white" position="0 -0.04 0.012" onclick="console.log('Menu Action')"></a-circle>
                    </a-box>
                </a-entity>
            </a-entity>

            <a-entity id="rightHand" 
                      hand-tracking-controls="hand: right; modelColor: #e0ac69;"
                      oculus-touch-controls="hand: right">
            </a-entity>
        </a-entity>

        <a-entity position="0 8 -8" rotation="25 0 0">
            <a-plane width="7" height="3.5" color="#000" opacity="0.9"></a-plane>
            <a-text id="leaderboard-text" value="" align="center" color="#FFD700" scale="2.5 2.5 2.5" position="0 0 0.1"></a-text>
        </a-entity>

        <a-sky src="#sky-tex" intensity="1.2"></a-sky>
        <a-plane class="nav-mesh" position="0 0 0" rotation="-90 0 0" width="40" height="40" src="#marble-gold-floor" repeat="5 5"></a-plane>
        
        <a-entity id="room-geometry">
            <a-box position="0 4 -15" width="30" height="8" src="#room-brand">
                <a-box position="0 3.9 0.15" width="30" height="0.2" color="#FFD700"></a-box>
                <a-box position="0 -3.9 0.15" width="30" height="0.2" color="#FFD700"></a-box>
                <a-entity position="0 0.5 0.2">
                    <a-box width="5.2" height="3.7" color="#FFD700"></a-box>
                    <a-plane width="5" height="3.5" position="0 0 0.06" src="#casino-art-2"></a-plane>
                </a-entity>
            </a-box>
            <a-box position="-15 4 0" rotation="0 90 0" width="30" height="8" src="#room-brand"></a-box>
            <a-box position="15 4 0" rotation="0 90 0" width="30" height="8" src="#room-brand"></a-box>
            <a-box position="0 4 15" rotation="0 0 0" width="30" height="8" src="#room-brand"></a-box>
            <a-box position="-14.8 4 -14.8" width="1" height="8" depth="1" color="#111"></a-box>
            <a-box position="14.8 4 -14.8" width="1" height="8" depth="1" color="#111"></a-box>
        </a-entity>

        <a-entity id="poker-table" position="0 0.7 -3">
            <a-cylinder radius="1.6" height="0.1" material="shader: poker-felt-shader; color: #076324;"></a-cylinder>
            <a-torus radius="1.65" radius-tubular="0.08" rotation="90 0 0" src="#table-trim" segments-tubular="64"></a-torus>
            <a-box onclick="document.querySelector('[poker-master]').components['poker-master'].sitPlayer()" 
                   position="0 0.5 2" width="1.2" height="0.3" depth="0.6" color="#FFD700">
                <a-text value="SIT TO PLAY" align="center" position="0 0.4 0" scale="0.8 0.8 0.8" color="black"></a-text>
            </a-box>
        </a-entity>

        <a-entity id="winner-overlay" position="0 2.5 -3" visible="false">
            <a-plane src="#winner-tex" width="3.5" height="1.8" transparent="true"></a-plane>
            <a-text id="win-text" value="" align="center" color="white" scale="1.8 1.8 1.8" position="0 0 0.1"></a-text>
        </a-entity>

        <a-light type="ambient" intensity="1.2"></a-light>
        <a-light type="point" position="0 8 0" intensity="1.5"></a-light>
    </a-scene>
</body>
</html>
