<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR - Update 1.3 Solid</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #ui {
            position: fixed; top: 10px; left: 10px; color: #00f2ff;
            font-family: 'Courier New', monospace; pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="ui">WALLET: $5,000 | STATUS: STANDING</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. THE PHYSICS (Capital P) ---
        class Physics {
            constructor() { this.colliders = []; }
            add(mesh) {
                const box = new THREE.Box3().setFromObject(mesh);
                this.colliders.push(box);
            }
        }
        const P = new Physics();

        // --- 2. ENGINE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        // SPAWN FIX: Move camera back so you aren't inside the wall/pillar
        camera.position.set(0, 1.6, 3); 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- 3. LIGHTING (No more black screen) ---
        const light = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(light);
        const point = new THREE.PointLight(0x00f2ff, 2, 20);
        point.position.set(0, 3.5, 0);
        scene.add(point);

        // --- 4. LUXURY INTERIOR (4m Ceiling + Brick Walls) ---
        const wallMat = new THREE.MeshStandardMaterial({ color: 0x4d1a1a }); // Brick
        const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.8 });

        // Floor (Large Marble)
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(50, 50), new THREE.MeshStandardMaterial({color: 0x111111}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        // Ceiling (Exactly 4 Meters)
        const ceil = new THREE.Mesh(new THREE.PlaneGeometry(50, 50), new THREE.MeshStandardMaterial({color: 0x050505}));
        ceil.position.y = 4;
        ceil.rotation.x = Math.PI/2;
        scene.add(ceil);

        // Lobby Brick Wall
        const backWall = new THREE.Mesh(new THREE.BoxGeometry(15, 4, 0.5), wallMat);
        backWall.position.set(0, 2, -7);
        scene.add(backWall);
        P.add(backWall);

        // Gold Pillars
        const createPillar = (x, z) => {
            const p = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 4), goldMat);
            p.position.set(x, 2, z);
            scene.add(p);
            P.add(p);
        };
        createPillar(-5, -5);
        createPillar(5, -5);

        // --- 5. AVATAR MIRROR (With Long Hair Logic) ---
        const mirrorFrame = new THREE.Mesh(new THREE.BoxGeometry(3, 2.5, 0.1), new THREE.MeshStandardMaterial({color: 0x222222}));
        mirrorFrame.position.set(-6, 1.5, 0);
        mirrorFrame.rotation.y = Math.PI/2;
        scene.add(mirrorFrame);

        // Placeholder for "Long Hair" Avatar reflection
        const hairRef = new THREE.Mesh(new THREE.CapsuleGeometry(0.2, 0.5, 4, 8), new THREE.MeshStandardMaterial({color: 0x2b1d0e}));
        hairRef.position.set(-5.9, 1.8, 0); // Visible in the mirror
        scene.add(hairRef);

        // --- 6. OCULUS CONTROLS (Right Trigger = OK) ---
        const controller1 = renderer.xr.getController(0);
        scene.add(controller1);

        controller1.addEventListener('selectstart', () => {
            console.log("OK Button Triggered");
            // Automatic Sit Logic: If near poker room, teleport to chair
            if(camera.position.z < -4) {
                camera.position.set(0, 1.1, -6); 
                document.getElementById('ui').innerText = "STATUS: SITTING - DEALING CARDS...";
            }
        });

        // --- 7. RENDER LOOP ---
        function animate() {
            renderer.setAnimationLoop(() => {
                renderer.render(scene, camera);
            });
        }
        animate();

    </script>
</body>
</html>
