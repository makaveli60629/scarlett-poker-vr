<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Skylark Poker VR</title>
  <style>
    html, body { margin:0; padding:0; height:100%; background:#05060a; color:#e9eefc; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #app { position: fixed; inset: 0; }
    canvas { display:block; width:100%; height:100%; }

    #hud {
      position: fixed; inset: 12px auto auto 12px; z-index: 999999;
      width: min(92vw, 760px);
      background: rgba(10,12,18,.86);
      border: 1px solid rgba(0,255,170,.35);
      border-radius: 12px;
      padding: 12px 14px;
      backdrop-filter: blur(6px);
    }
    #title { font-weight:800; letter-spacing:.2px; font-size: 16px; margin:0 0 6px; }
    #status { display:flex; gap:10px; align-items:center; margin: 0 0 8px; flex-wrap: wrap; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;
    }
    .ok { border-color: rgba(0,255,170,.35); }
    .bad { border-color: rgba(255,60,120,.35); }
    #log {
      white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.35;
      margin: 0;
      max-height: 45vh;
      overflow:auto;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <div id="hud">
    <div id="title">Skylark Poker VR — Debug HUD</div>
    <div id="status">
      <span id="htmlPill" class="pill ok">✅ HTML loaded</span>
      <span id="jsPill" class="pill bad">⏳ JS booting…</span>
      <span id="xrPill" class="pill bad">XR: unknown</span>
      <span id="verPill" class="pill ok">v: -</span>
    </div>
    <pre id="log">Waiting for main.js…</pre>
  </div>

  <script>
    const logEl = document.getElementById("log");
    const jsPill = document.getElementById("jsPill");
    const xrPill = document.getElementById("xrPill");
    const verPill = document.getElementById("verPill");
    const log = (line) => { logEl.textContent += (logEl.textContent ? "\n" : "") + line; };

    const V = Date.now().toString();
    verPill.textContent = "v: " + V;

    window.__HUD__ = { log, jsPill, xrPill, V };

    window.addEventListener("error", (e) => {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "❌ ERROR";
      log("ERROR: " + (e.message || "Unknown"));
      if (e.filename) log("FILE: " + e.filename + ":" + e.lineno + ":" + e.colno);
    });

    window.addEventListener("unhandledrejection", (e) => {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "❌ IMPORT FAILED";
      log("PROMISE REJECTION:");
      log(String(e.reason?.stack || e.reason || e));
    });
  </script>

  <script type="module">
    const { log, jsPill, xrPill, V } = window.__HUD__;
    try {
      const mod = await import("./js/main.js?v=" + V);
      await mod.boot();

      jsPill.classList.remove("bad"); jsPill.classList.add("ok");
      jsPill.textContent = "✅ boot() ok";
      log("boot() finished");

      // LIVE XR status poll (doesn't rely on events)
      setInterval(() => {
        try {
          const presenting = !!window.__SKYLARK__?.renderer?.xr?.isPresenting;
          if (presenting) {
            xrPill.classList.remove("bad"); xrPill.classList.add("ok");
            xrPill.textContent = "XR: presenting ✅";
          } else {
            xrPill.classList.remove("ok"); xrPill.classList.add("bad");
            xrPill.textContent = "XR: not presenting";
          }
        } catch {
          xrPill.classList.remove("ok"); xrPill.classList.add("bad");
          xrPill.textContent = "XR: unknown";
        }
      }, 500);

    } catch (err) {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "❌ IMPORT FAILED";
      log("IMPORT ERROR:");
      log(String(err?.stack || err));
      throw err;
    }
  </script>
</body>
</html>
