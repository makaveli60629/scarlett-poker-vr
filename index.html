<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR - v1.3 Ultra-Stable</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-cursor-teleport@1.5.0/dist/aframe-cursor-teleport-component.min.js"></script>
</head>
<body>
    <a-scene renderer="antialias: true; colorManagement: true;" loading-screen="enabled: false">
        
        <a-assets>
            <a-mixin id="brick-wall" geometry="primitive: box" material="color: #442222; roughness: 1; metalness: 0"></a-mixin>
            <a-mixin id="poker-table" geometry="primitive: cylinder; radius: 1.8; height: 0.15;" material="color: #074a07; roughness: 1"></a-mixin>
        </a-assets>

        <a-entity light="type: ambient; intensity: 0.7; color: #FFF"></a-entity>
        <a-entity light="type: directional; intensity: 1; position: -1 5 2" castShadow="true"></a-entity>

        <a-entity id="rig" position="0 0 5">
            <a-camera id="camera" look-controls wasd-controls>
                <a-cursor color="yellow"></a-cursor>
            </a-camera>
            <a-entity id="leftHand" oculus-touch-controls="hand: left" teleport-controls="button: trigger; collisionEntities: .nav-mesh; cameraRig: #rig; teleportOrigin: #camera;"></a-entity>
            <a-entity id="rightHand" oculus-touch-controls="hand: right" teleport-controls="button: trigger; collisionEntities: .nav-mesh; cameraRig: #rig; teleportOrigin: #camera;"></a-entity>
        </a-entity>

        <a-entity id="lobby-zone">
            <a-plane class="nav-mesh" rotation="-90 0 0" width="100" height="100" material="color: #222" visible="true"></a-plane>
            
            <a-box position="0 2.5 -8" width="16" height="5" depth="0.5" mixin="brick-wall"></a-box>
            <a-box position="-8 2.5 0" rotation="0 90 0" width="16" height="5" depth="0.5" mixin="brick-wall"></a-box>
            <a-box position="8 2.5 0" rotation="0 -90 0" width="16" height="5" depth="0.5" mixin="brick-wall"></a-box>

            <a-text value="LOBBY & STORE" align="center" position="0 4 -7.8" color="gold" width="10"></a-text>

            <a-entity position="-3 1 -4">
                <a-entity mixin="poker-table"></a-entity>
                <a-cylinder radius="0.1" height="1" position="0 -0.5 0" color="#111"></a-cylinder>
                <a-text value="DAILY PICK" align="center" position="0 1.2 0" color="cyan" width="4"></a-text>
                <a-cylinder id="blue-chip" class="clickable" position="0 0.1 0" radius="0.15" height="0.05" color="blue"
                            animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
                            onclick="claimDaily()"></a-cylinder>
            </a-entity>

            <a-entity position="4 1.8 -4">
                <a-text id="wallet-text" value="WALLET: $2500" align="center" color="white" width="6"></a-text>
                <a-box class="clickable" position="0 -1 0" width="1.5" height="0.1" depth="1.5" color="green" onclick="goToGame()">
                    <a-text value="ENTER PLANE TABLES" align="center" position="0 0.1 0" rotation="-90 0 0" width="4"></a-text>
                </a-box>
            </a-entity>
        </a-entity>

        <a-entity id="poker-zone" position="100 0 0">
            <a-plane class="nav-mesh" rotation="-90 0 0" width="100" height="100" material="color: #111"></a-plane>
            <a-box position="0 2.5 -8" width="16" height="5" depth="0.5" mixin="brick-wall"></a-box>
            <a-text value="PLANE TABLES ZONE" align="center" position="0 4 -7.8" color="#00ffff" width="10"></a-text>

            <a-entity id="main-table" position="0 1 -3">
                <a-entity mixin="poker-table"></a-entity>
                <a-cylinder radius="0.3" height="1" position="0 -0.5 0" color="#222"></a-cylinder>
                <a-text value="ELITE BRAND" align="center" position="0 0.1 0" rotation="-90 0 0" color="gold" width="6"></a-text>
                
                <a-entity id="win-display" visible="false" position="0 1.5 0">
                    <a-text id="win-text" value="" align="center" color="yellow" width="12"></a-text>
                </a-entity>
            </a-entity>

            <a-box class="clickable" position="0 0.5 -1" width="1" height="0.1" depth="1" color="green" onclick="autoSit()">
                <a-text value="SIT & PLAY" align="center" position="0 0.1 0" rotation="-90 0 0"></a-text>
            </a-box>
        </a-entity>

    </a-scene>

    <script>
        let wallet = 2500;

        function claimDaily() {
            let win = Math.floor(Math.random() * 4500) + 500;
            wallet += win;
            document.querySelector('#wallet-text').setAttribute('value', 'WALLET: $' + wallet);
            console.log("Win: " + win);
        }

        function goToGame() {
            document.querySelector('#rig').setAttribute('position', '100 0 5');
        }

        function autoSit() {
            // Lock position to table
            document.querySelector('#rig').setAttribute('position', '100 0 -1.5');
            // Deal Cards (Low poly)
            dealCards();
        }

        function dealCards() {
            const table = document.querySelector('#main-table');
            for(let i=0; i<2; i++) {
                let card = document.createElement('a-box');
                card.setAttribute('width', '0.15');
                card.setAttribute('height', '0.01');
                card.setAttribute('depth', '0.22');
                card.setAttribute('position', `${-0.2 + (i*0.4)} 0.1 -0.5`);
                card.setAttribute('color', 'white');
                table.appendChild(card);
            }
            // Trigger 10-second win
            setTimeout(() => { showWin("YOU", 1000); }, 3000);
        }

        function showWin(winner, amount) {
            const ui = document.querySelector('#win-display');
            const txt = document.querySelector('#win-text');
            txt.setAttribute('value', winner + " WINS $" + amount);
            ui.setAttribute('visible', 'true');
            setTimeout(() => { ui.setAttribute('visible', 'false'); }, 10000);
        }
    </script>
</body>
</html>
