<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Skylark Poker VR — 9.0</title>

  <!-- ✅ FIX: importmap so "three" works on GitHub Pages + Quest browser -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <style>
    html, body { margin:0; padding:0; height:100%; background:#05060a; color:#e9eefc; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #app { position: fixed; inset: 0; }
    canvas { display:block; width:100%; height:100%; }

    #hud {
      position: fixed; left: 12px; top: 12px; z-index: 999999;
      width: min(92vw, 780px);
      background: rgba(10,12,18,.82);
      border: 1px solid rgba(0,255,170,.35);
      border-radius: 12px;
      padding: 12px 14px;
      backdrop-filter: blur(6px);
      pointer-events: auto;
    }
    #title { font-weight:800; letter-spacing:.2px; font-size: 16px; margin:0 0 6px; }
    #status { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin: 0 0 8px; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;
    }
    .ok { border-color: rgba(0,255,170,.35); }
    .bad { border-color: rgba(255,60,120,.35); }

    #menuRow { display:flex; gap:10px; margin: 8px 0 10px; flex-wrap: wrap; }
    .btn {
      cursor:pointer; user-select:none;
      padding: 8px 12px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: #e9eefc;
      font-weight: 700;
      font-size: 12px;
    }
    .btn:hover { border-color: rgba(0,255,170,.35); }

    #log {
      white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.35;
      margin: 0;
      max-height: 42vh;
      overflow:auto;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <div id="hud">
    <div id="title">Skylark Poker VR — Update 9.0</div>
    <div id="status">
      <span id="htmlPill" class="pill ok">✅ HTML loaded</span>
      <span id="jsPill" class="pill bad">⏳ JS booting…</span>
    </div>

    <div id="menuRow">
      <button class="btn" id="btnLobby">Lobby</button>
      <button class="btn" id="btnPoker">Poker</button>
      <button class="btn" id="btnStore">Store</button>
      <button class="btn" id="btnReset">Reset Spawn</button>
    </div>

    <pre id="log">Waiting for main.js…</pre>
  </div>

  <script>
    const logEl = document.getElementById("log");
    const jsPill = document.getElementById("jsPill");

    function log(line) {
      logEl.textContent = (logEl.textContent === "Waiting for main.js…" ? "" : logEl.textContent + "\n") + line;
    }

    window.addEventListener("error", (e) => {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "❌ ERROR";
      log("ERROR: " + (e.message || e.error || "Unknown"));
      if (e.filename) log("FILE: " + e.filename + ":" + e.lineno + ":" + e.colno);
    });

    window.addEventListener("unhandledrejection", (e) => {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "❌ IMPORT FAILED";
      log("PROMISE REJECTION:");
      log(String(e.reason?.stack || e.reason || e));
    });

    log("Tip: reload with ?v=" + Date.now() + " if cache acts weird.");
  </script>

  <script type="module">
    const jsPill = document.getElementById("jsPill");
    const logEl = document.getElementById("log");
    const log = (line) => { logEl.textContent = (logEl.textContent === "Waiting for main.js…" ? "" : logEl.textContent + "\n") + line; };

    try {
      const mod = await import("./js/main.js");
      if (mod?.boot) {
        await mod.boot();
        jsPill.classList.remove("bad"); jsPill.classList.add("ok");
        jsPill.textContent = "✅ boot() ok";
        log("main.js boot() executed.");
      } else {
        jsPill.classList.remove("bad"); jsPill.classList.add("ok");
        jsPill.textContent = "✅ main.js loaded";
        log("main.js imported (no boot export).");
      }
    } catch (err) {
      jsPill.classList.remove("ok"); jsPill.classList.add("bad");
      jsPill.textContent = "❌ IMPORT FAILED";
      log("IMPORT ERROR:");
      log(String(err?.stack || err));
      throw err;
    }
  </script>
</body>
</html>
