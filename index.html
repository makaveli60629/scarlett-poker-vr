<script type="module">
  const jsPill = document.getElementById("jsPill");
  const logEl = document.getElementById("log");
  const log = (line) => { logEl.textContent += (logEl.textContent ? "\n" : "") + line; };

  // One cache-bust value for this whole page load
  const V = new URLSearchParams(location.search).get("v") || String(Date.now());
  log("Using cache-bust v=" + V);

  try {
    // IMPORTANT: cache-bust main.js so the whole import tree refreshes
    const mod = await import(`./js/main.js?v=${encodeURIComponent(V)}`);

    // If your main.js exports boot(), call it; otherwise just run
    if (mod?.boot) {
      await mod.boot();
      jsPill.classList.remove("bad"); jsPill.classList.add("ok");
      jsPill.textContent = "✅ boot() ok";
      log("main.js boot() executed.");
    } else {
      jsPill.classList.remove("bad"); jsPill.classList.add("ok");
      jsPill.textContent = "✅ main.js loaded";
      log("main.js imported (no boot export).");
    }
  } catch (err) {
    jsPill.classList.remove("ok"); jsPill.classList.add("bad");
    jsPill.textContent = "❌ IMPORT FAILED";
    log("IMPORT ERROR:");
    log(String(err?.stack || err));
    throw err;
  }
</script>
