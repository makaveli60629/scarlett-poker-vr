<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR 1.3 - Master Build</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        /* This makes the VR button huge and impossible to miss */
        #VRButton { 
            position: absolute !important; 
            bottom: 50px !important; 
            left: 50% !important; 
            transform: translateX(-50%) !important;
            background: #00f2ff !important; 
            color: #000 !important; 
            padding: 20px 40px !important;
            font-size: 24px !important;
            border-radius: 10px !important;
            border: 2px solid white !important;
        }
        #wallet-ui {
            position: fixed; top: 20px; left: 20px; color: #00f2ff;
            font-size: 24px; font-weight: bold; z-index: 100;
        }
    </style>
</head>
<body>
    <div id="wallet-ui">WALLET: $<span id="balance">5000</span></div>

    <script type="importmap">
        { "imports": { 
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" 
        } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'three/addons/webxr/VRButton.js';
        import { XRControllerModelFactory } from 'three/addons/webxr/XRControllerModelFactory.js';

        // --- 1. ENGINE & VR SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a); // Dark background
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        // ADD VR BUTTON
        document.body.appendChild(VRButton.createButton(renderer));

        const playerRig = new THREE.Group();
        playerRig.add(camera);
        scene.add(playerRig);
        playerRig.position.set(0, 0, 5); // Start in the room

        // --- 2. LIGHTING (Essential to see) ---
        const amb = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(amb);
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(5, 10, 7.5);
        scene.add(sun);

        // --- 3. ARCHITECTURE (4M SOLID WALLS) ---
        const brickMat = new THREE.MeshStandardMaterial({ color: 0x8b2222 }); // Red Brick
        const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.8 });

        // Floor
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(30, 30), new THREE.MeshStandardMaterial({color: 0x111111}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        // Solid Walls (4 meters high)
        function createWall(x, z, w, r) {
            const wall = new THREE.Mesh(new THREE.BoxGeometry(w, 4, 0.5), brickMat);
            wall.position.set(x, 2, z);
            wall.rotation.y = r;
            scene.add(wall);
        }
        createWall(0, -15, 30, 0);          // Back Wall
        createWall(-15, 0, 30, Math.PI/2);  // Left Wall
        createWall(15, 0, 30, Math.PI/2);   // Right Wall

        // Gold Pillars
        const pillar = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 4), goldMat);
        pillar.position.set(-14, 2, -14);
        scene.add(pillar);

        // --- 4. THE POKER TABLE ---
        const table = new THREE.Mesh(new THREE.CylinderGeometry(2.5, 2.5, 0.2, 32), new THREE.MeshStandardMaterial({color: 0x076324}));
        table.position.set(0, 0.8, -5);
        scene.add(table);

        // --- 5. OCULUS CONTROLS ---
        const factory = new XRControllerModelFactory();
        
        // Right Hand
        const c0 = renderer.xr.getController(0);
        playerRig.add(c0);
        const g0 = renderer.xr.getControllerGrip(0);
        g0.add(factory.createControllerModel(g0));
        playerRig.add(g0);

        // Left Hand
        const c1 = renderer.xr.getController(1);
        playerRig.add(c1);
        const g1 = renderer.xr.getControllerGrip(1);
        g1.add(factory.createControllerModel(g1));
        playerRig.add(g1);

        // --- 6. RENDER LOOP (WITH THUMBSTICK MOVEMENT) ---
        renderer.setAnimationLoop(() => {
            const session = renderer.xr.getSession();
            if (session) {
                for (const source of session.inputSources) {
                    if (source.gamepad && source.handedness === 'left') {
                        const axes = source.gamepad.axes;
                        const dir = new THREE.Vector3(axes[2], 0, axes[3]).applyQuaternion(camera.quaternion);
                        dir.y = 0;
                        playerRig.position.addScaledVector(dir, 0.1);
                    }
                }
            }
            renderer.render(scene, camera);
        });
    </script>
</body>
</html>
