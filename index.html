<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>POKER VR MASTER - CONTROLS LOCKED</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; }
    </style>
</head>
<body>
    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
        import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/webxr/VRButton.js';

        // 1. SETUP ENGINE
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);
        document.body.appendChild(VRButton.createButton(renderer));

        // 2. CAMERA RIG (Necessary for Joystick Movement)
        const cameraRig = new THREE.Group();
        cameraRig.add(camera);
        scene.add(cameraRig);

        // 3. LIGHT & WORLD (Permanent Grid)
        scene.add(new THREE.AmbientLight(0xffffff, 1));
        const grid = new THREE.GridHelper(100, 100, 0x00ffcc, 0x222222);
        scene.add(grid);

        // 4. CONTROLLERS (Tracking)
        const controller1 = renderer.xr.getController(0);
        const controller2 = renderer.xr.getController(1);
        cameraRig.add(controller1, controller2);

        // 5. MOVEMENT LOGIC
        function updateMovement() {
            const session = renderer.xr.getSession();
            if (session) {
                for (const source of session.inputSources) {
                    if (source.gamepad) {
                        const axes = source.gamepad.axes; // [thumbstickX, thumbstickY]
                        
                        // Left Controller Movement
                        if (source.handedness === 'left') {
                            cameraRig.position.x += axes[2] * 0.1; // Move Left/Right
                            cameraRig.position.z += axes[3] * 0.1; // Move Forward/Back
                        }
                        
                        // Right Controller Rotation
                        if (source.handedness === 'right') {
                            if (Math.abs(axes[2]) > 0.5) {
                                cameraRig.rotation.y -= axes[2] * 0.05;
                            }
                        }
                    }
                }
            }
        }

        // 6. ANIMATION LOOP
        renderer.setAnimationLoop(() => {
            updateMovement();
            renderer.render(scene, camera);
        });

        console.log("Update 1.5.1: Controllers and Joysticks PERMANENTLY active.");
    </script>
</body>
</html>
