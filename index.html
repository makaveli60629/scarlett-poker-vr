<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR Update 1.5.2 - Stable Build</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        #canvas-container { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'three/addons/webxr/VRButton.js';

        const App = {
            scene: null, camera: null, renderer: null,
            player: new THREE.Group(), controllers: [],
            isSeated: false,

            init() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x111111); // Dark grey, not black

                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.player.position.set(0, 1.6, 10); // Spawning far back so you can see the room
                this.player.add(this.camera);
                this.scene.add(this.player);

                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.xr.enabled = true;
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);
                document.body.appendChild(VRButton.createButton(this.renderer));

                this.createLobby();
                this.setupLights();
                this.setupControls();
                this.animate();
            },

            createLobby() {
                // Room logic (Integrated from 1.3/1.4)
                const roomGeo = new THREE.BoxGeometry(40, 20, 40);
                const roomMat = new THREE.MeshStandardMaterial({ color: 0x444444, side: THREE.BackSide });
                const room = new THREE.Mesh(roomGeo, roomMat);
                this.scene.add(room);

                // The Table (The Gray Disc)
                const tableGeo = new THREE.CylinderGeometry(3, 3, 0.2, 32);
                const tableMat = new THREE.MeshStandardMaterial({ color: 0x005500 });
                const table = new THREE.Mesh(tableGeo, tableMat);
                table.position.set(0, 0.8, -5);
                this.scene.add(table);
            },

            setupLights() {
                const light = new THREE.DirectionalLight(0xffffff, 2);
                light.position.set(5, 10, 5);
                this.scene.add(light);
                this.scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            },

            setupControls() {
                // FLAT SCREEN MOVEMENT
                window.addEventListener('keydown', (e) => {
                    if(this.isSeated) return;
                    const speed = 0.5;
                    if(e.key === 'w') this.player.position.z -= speed;
                    if(e.key === 's') this.player.position.z += speed;
                    if(e.key === 'a') this.player.position.x -= speed;
                    if(e.key === 'd') this.player.position.x += speed;

                    // Proximity Trigger: Sit down if near table
                    if(this.player.position.distanceTo(new THREE.Vector3(0, 1.6, -5)) < 4) {
                        this.sitDown();
                    }
                });
            },

            sitDown() {
                if(this.isSeated) return;
                this.isSeated = true;
                this.player.position.set(0, 1.2, -3.5); // Snap to chair
                this.showWinnerPopup("HAND START", "GOOD LUCK");
            },

            showWinnerPopup(name, hand) {
                const div = document.createElement('div');
                div.style.cssText = "position:fixed; top:20%; width:100%; text-align:center; color:#00FF00; font-size:40px; font-family:Arial;";
                div.innerHTML = `WINNER: ${name}<br>${hand}`;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 10000);
            },

            animate() {
                this.renderer.setAnimationLoop(() => {
                    this.renderer.render(this.scene, this.camera);
                });
            }
        };

        App.init();
    </script>
</body>
</html>
