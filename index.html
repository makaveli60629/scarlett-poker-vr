<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker VR 1.3 - Fixed Spawn & Controls</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        /* The VR Button will appear at the bottom of the screen */
    </style>
</head>
<body>
    <script type="importmap">
        { "imports": { 
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" 
        } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'three/addons/webxr/VRButton.js';
        import { XRControllerModelFactory } from 'three/addons/webxr/XRControllerModelFactory.js';

        // --- 1. CORE ENGINE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        // SPAWN POINT: Moved to (0, 1.6, 8) so you are far away from the walls
        camera.position.set(0, 1.6, 8); 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);
        document.body.appendChild(VRButton.createButton(renderer));

        // --- 2. LIGHTING (Failsafe) ---
        const amb = new THREE.AmbientLight(0xffffff, 0.9);
        scene.add(amb);

        // --- 3. LUXURY INTERIOR (4M Ceiling & Solid Walls) ---
        const brickMat = new THREE.MeshStandardMaterial({ color: 0x8b0000 }); // Red-Orange Brick
        const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.8 });

        // Floor
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), new THREE.MeshStandardMaterial({color: 0x111111}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        // Ceiling (4 Meters High)
        const ceil = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), new THREE.MeshStandardMaterial({color: 0x111111}));
        ceil.position.y = 4;
        ceil.rotation.x = Math.PI/2;
        scene.add(ceil);

        // The Brick Walls (Spaced out so you don't spawn inside them)
        const createWall = (x, z, w, h) => {
            const wall = new THREE.Mesh(new THREE.BoxGeometry(w, h, 0.5), brickMat);
            wall.position.set(x, h/2, z);
            scene.add(wall);
        };
        createWall(0, -10, 20, 4); // Back Wall

        // Gold Pillars
        const createPillar = (x, z) => {
            const p = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 4), goldMat);
            p.position.set(x, 2, z);
            scene.add(p);
        };
        createPillar(-5, -5);
        createPillar(5, -5);

        // --- 4. CONTROLLER & HAND VISUALS ---
        const controllerModelFactory = new XRControllerModelFactory();
        
        // Right Controller
        const controller1 = renderer.xr.getController(0);
        scene.add(controller1);
        const grip1 = renderer.xr.getControllerGrip(0);
        grip1.add(controllerModelFactory.createControllerModel(grip1));
        scene.add(grip1);

        // --- 5. OK TRIGGER & MOVEMENT ---
        controller1.addEventListener('selectstart', () => {
            // "OK" Button Logic: Teleport 2 meters forward
            const direction = new THREE.Vector3();
            controller1.getWorldDirection(direction);
            camera.position.addScaledVector(direction, -2); // Teleport move
            console.log("Teleported Forward");
        });

        // --- 6. RENDER LOOP ---
        renderer.setAnimationLoop(() => {
            renderer.render(scene, camera);
        });

    </script>
</body>
</html>
