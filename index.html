<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Scarlett Loader Truth Test</title>
  <style>
    html,body{margin:0;height:100%;background:#05060a;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial;}
    .wrap{padding:14px;max-width:900px}
    .card{background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:12px;margin:10px 0;}
    code,pre{white-space:pre-wrap;word-break:break-word}
    .ok{color:#9dffb0}
    .bad{color:#ff9d9d}
    button{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.25);background:rgba(0,0,0,.35);color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Scarlett “What Am I Really Loading?” Diagnostic</h2>

    <div class="card">
      <div><b>URL:</b> <span id="url"></span></div>
      <div><b>Time:</b> <span id="time"></span></div>
      <div><b>UserAgent:</b> <span id="ua"></span></div>
    </div>

    <div class="card">
      <b>Cache Buster Link</b><br/>
      <button id="reload">Reload with cache buster</button>
    </div>

    <div class="card">
      <b>Fetch Test</b> (Does this file exist where you think it does?)<br/>
      <pre id="fetch"></pre>
    </div>

    <div class="card">
      <b>Script Load Test</b><br/>
      <pre id="load"></pre>
    </div>

    <div class="card">
      <b>Result</b><br/>
      <pre id="result"></pre>
    </div>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    $("url").textContent = location.href;
    $("time").textContent = new Date().toString();
    $("ua").textContent = navigator.userAgent;

    $("reload").onclick = () => {
      const v = Date.now();
      const base = location.href.split("?")[0];
      location.href = base + "?v=" + v;
    };

    // IMPORTANT:
    // Change these TWO paths depending on where you uploaded the ZIP:
    // If you uploaded to root, keep as "./js/main.js"
    // If you uploaded to /surgical_v4_4/, change to "./surgical_v4_4/js/main.js"
    const MAIN_JS_PATH = "./js/main.js";

    async function run() {
      let out = "";

      // 1) Fetch test — proves what path exists on GitHub Pages
      try {
        const r = await fetch(MAIN_JS_PATH + "?v=" + Date.now(), { cache: "no-store" });
        out += `FETCH ${MAIN_JS_PATH} -> ${r.status} ${r.ok ? "OK" : "FAIL"}\n`;
        if (r.ok) {
          const txt = await r.text();
          out += `First 200 chars:\n${txt.slice(0,200)}\n`;
        }
      } catch (e) {
        out += `FETCH ERROR: ${e}\n`;
      }
      $("fetch").textContent = out;

      // 2) Script load test — actually loads the JS file and reads BUILD if present
      const loadLog = [];
      const s = document.createElement("script");
      s.type = "module";
      s.src = MAIN_JS_PATH + "?v=" + Date.now();
      s.onload = () => loadLog.push("✅ main.js loaded");
      s.onerror = () => loadLog.push("❌ main.js failed to load (wrong path or 404)");
      document.body.appendChild(s);

      setTimeout(() => {
        $("load").textContent = loadLog.join("\n");

        // 3) Result readout
        const build =
          (window.APP_STATE && window.APP_STATE.build) ? window.APP_STATE.build :
          (window.BUILD ? window.BUILD : "(no BUILD found on window)");

        let res = "";
        res += `window.APP_STATE.build = ${build}\n`;
        res += `If this shows v4_3, you're still loading old Scarlett1 files.\n`;
        res += `If this shows v4_4, the ZIP is actually running.\n`;
        $("result").textContent = res;
      }, 1200);
    }
    run();
  </script>
</body>
</html>
